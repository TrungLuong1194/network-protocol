\documentclass[a4paper,12pt]{article}
\usepackage{listings}
\lstset{
    basicstyle=\ttfamily,
    columns=flexible,
    breaklines=true
}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<Механизмы протокола TCP>>}
\author{Trung Luong}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Установка и разрыв соединения}

Дампим интерфейсы с2 и с3 при попытке соединения с1 с сервером (порт 9)

\begin{lstlisting}
c1:~# telnet 10.50.0.2 9
Trying 10.50.0.2...
Connected to 10.50.0.2.
Escape character is '^]'.
Hello World
Test

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
10:48:44.191372 IP 10.10.0.2.50432 > 10.50.0.2.9: S 2382101503:2382101503(0) win 5840 <mss 1460,sackOK,timestamp 171081 0,nop,wscale 1>
10:48:44.227018 IP 10.50.0.2.9 > 10.10.0.2.50432: S 2384188242:2384188242(0) ack 2382101504 win 5792 <mss 536,sackOK,timestamp 171083 171081,nop,wscale 1>
10:48:44.227415 IP 10.10.0.2.50432 > 10.50.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 171087 171083>
10:48:54.146170 IP 10.10.0.2.50432 > 10.50.0.2.9: P 1:14(13) ack 1 win 2920 <nop,nop,timestamp 172079 171083>
10:48:54.146645 IP 10.50.0.2.9 > 10.10.0.2.50432: . ack 14 win 2896 <nop,nop,timestamp 172075 172079>
10:48:57.349384 IP 10.10.0.2.50432 > 10.50.0.2.9: P 14:20(6) ack 1 win 2920 <nop,nop,timestamp 172399 172075>
10:48:57.350698 IP 10.50.0.2.9 > 10.10.0.2.50432: . ack 20 win 2896 <nop,nop,timestamp 172395 172399>
10:49:04.037499 IP 10.10.0.2.50432 > 10.50.0.2.9: F 20:20(0) ack 1 win 2920 <nop,nop,timestamp 173068 172395>
10:49:04.042750 IP 10.50.0.2.9 > 10.10.0.2.50432: F 1:1(0) ack 21 win 2896 <nop,nop,timestamp 173064 173068>
10:49:04.043053 IP 10.10.0.2.50432 > 10.50.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 173068 173064>


c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
10:48:44.212494 IP 10.10.0.2.50432 > 10.50.0.2.9: S 2382101503:2382101503(0) win 5840 <mss 1460,sackOK,timestamp 171081 0,nop,wscale 1>
10:48:44.235886 IP 10.50.0.2.9 > 10.10.0.2.50432: S 2384188242:2384188242(0) ack 2382101504 win 5792 <mss 536,sackOK,timestamp 171083 171081,nop,wscale 1>
10:48:44.236695 IP 10.10.0.2.50432 > 10.50.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 171087 171083>
10:48:54.155360 IP 10.10.0.2.50432 > 10.50.0.2.9: P 1:14(13) ack 1 win 2920 <nop,nop,timestamp 172079 171083>
10:48:54.155641 IP 10.50.0.2.9 > 10.10.0.2.50432: . ack 14 win 2896 <nop,nop,timestamp 172075 172079>
10:48:57.358780 IP 10.10.0.2.50432 > 10.50.0.2.9: P 14:20(6) ack 1 win 2920 <nop,nop,timestamp 172399 172075>
10:48:57.359562 IP 10.50.0.2.9 > 10.10.0.2.50432: . ack 20 win 2896 <nop,nop,timestamp 172395 172399>
10:49:04.046915 IP 10.10.0.2.50432 > 10.50.0.2.9: F 20:20(0) ack 1 win 2920 <nop,nop,timestamp 173068 172395>
10:49:04.051605 IP 10.50.0.2.9 > 10.10.0.2.50432: F 1:1(0) ack 21 win 2896 <nop,nop,timestamp 173064 173068>
10:49:04.052294 IP 10.10.0.2.50432 > 10.50.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 173068 173064>
\end{lstlisting}

\section{Окно получателя}

Впервые необходимо запускать сервер с4

\begin{lstlisting}
c4:~# gcc -o win win.c
c4:~# ./win 3002 2 10
\end{lstlisting}

Здесь 3002 — номер порта, который она будет слушать, 2 — величина задержки в секундах, 5 — число принимаемых (после паузы) пакетов.

Теперь запустим клиента на машине c1
\begin{lstlisting}
c1:~# netcat 10.30.0.2 3002 </dev/zero/
\end{lstlisting}

Затем запустим на машине c3 программу tcpdump
\begin{lstlisting}
c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
11:40:30.736796 IP 10.10.0.2.47564 > 10.30.0.2.3002: S 3864737763:3864737763(0) win 5840 <mss 1460,sackOK,timestamp 481732 0,nop,wscale 1>
11:40:30.737181 IP 10.30.0.2.3002 > 10.10.0.2.47564: S 3876910229:3876910229(0) ack 3864737764 win 2096 <mss 536,sackOK,timestamp 481717 481732,nop,wscale 1>
11:40:30.737648 IP 10.10.0.2.47564 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.737941 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.737960 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738079 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 525 win 1572 <nop,nop,timestamp 481717 481732>
11:40:30.738096 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 1049 win 2096 <nop,nop,timestamp 481717 481732>
11:40:30.738330 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 1049:1573(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738344 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 1573:2097(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738364 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 2097:2621(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738370 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 2621:3145(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738465 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 1573 win 2620 <nop,nop,timestamp 481717 481732>
11:40:30.738475 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 2097 win 3144 <nop,nop,timestamp 481717 481732>
11:40:30.738494 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 2621 win 3668 <nop,nop,timestamp 481717 481732>
11:40:30.738500 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 3145 win 4192 <nop,nop,timestamp 481717 481732>
11:40:30.738766 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 3145:3669(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738791 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 3669:4193(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738797 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 4193:4717(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738816 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 4717:5241(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738821 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 5241:5765(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738837 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 5765:6289(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738855 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 6289:6813(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738861 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 6813:7337(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.738886 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 3669 win 4716 <nop,nop,timestamp 481717 481732>
11:40:30.738905 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 4193 win 5240 <nop,nop,timestamp 481717 481732>
11:40:30.738921 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 4717 win 5764 <nop,nop,timestamp 481717 481732>
11:40:30.738945 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 5241 win 6288 <nop,nop,timestamp 481717 481732>
11:40:30.738971 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 5765 win 6812 <nop,nop,timestamp 481717 481732>
11:40:30.738976 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 6289 win 7336 <nop,nop,timestamp 481717 481732>
11:40:30.738981 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 6813 win 7860 <nop,nop,timestamp 481717 481732>
11:40:30.738996 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 7337 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739134 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 7337:7861(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739147 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 7861:8385(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739171 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 8385:8909(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739188 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 8909:9433(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739243 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 9433:9957(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739255 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 9957:10481(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739278 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 10481:11005(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739287 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 7861 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739321 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 11005:11529(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739328 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 11529:12053(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739350 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 12053:12577(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739358 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 8385 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739363 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 9433 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739380 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 12577:13101(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739386 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 13101:13625(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739407 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 13625:14149(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>

*** big win appears ***

11:40:30.739414 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 10481 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739419 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 11529 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739438 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 14149:14673(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739478 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 12577 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739515 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 13625 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739553 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 14673:15197(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739566 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 14673 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739577 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 15197:15721(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739696 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 15721 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739764 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 15721:16245(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739780 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 16245:16385(140) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739895 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 16385:16909(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739905 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 16909:17433(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739932 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 17433:17957(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739938 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 17957:18481(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739945 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 16385 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.739957 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 18481:19005(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739972 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 19005:19529(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.739987 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 19529:20053(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740018 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 20053:20577(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740037 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 20577:21101(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740044 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 17433 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.740064 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 21101:21625(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740069 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 21625:22149(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740076 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 18481 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.740090 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 22149:22673(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740122 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 22673:23197(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740129 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 23197:23721(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740144 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 23721:24245(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740330 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 24245:24577(332) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740459 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 24577:25101(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740483 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 25101:25625(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740514 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 25625:26149(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740525 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 26149:26673(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740534 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 26673:27197(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740562 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 27197:27721(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740582 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 27721:28245(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740588 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 28245:28769(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.740898 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 27197 win 4026 <nop,nop,timestamp 481717 481732>
11:40:30.740920 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 27721 win 3764 <nop,nop,timestamp 481717 481732>
11:40:30.740927 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 28245 win 3502 <nop,nop,timestamp 481717 481732>
11:40:30.740932 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 28769 win 3240 <nop,nop,timestamp 481717 481732>
11:40:30.741450 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 28769:29293(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741466 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 29293:29817(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741472 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 29817:30341(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741477 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 30341:30865(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741482 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 30865:31389(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741487 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 31389:31913(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741494 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 31913:32437(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741502 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 32437:32961(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741510 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 32961:33485(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741518 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 33485:34009(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741526 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 34009:34533(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741536 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 34533:35057(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.741662 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 29293 win 3144 <nop,nop,timestamp 481717 481732>
11:40:30.741680 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 29817 win 3668 <nop,nop,timestamp 481717 481732>
11:40:30.741689 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 30341 win 4192 <nop,nop,timestamp 481717 481732>
11:40:30.741743 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 30865 win 4716 <nop,nop,timestamp 481717 481732>
11:40:30.741758 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 31389 win 5240 <nop,nop,timestamp 481717 481732>
11:40:30.741764 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 31913 win 5764 <nop,nop,timestamp 481717 481732>
11:40:30.741769 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 32437 win 6288 <nop,nop,timestamp 481717 481732>
11:40:30.741774 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 32961 win 6812 <nop,nop,timestamp 481717 481732>
11:40:30.741779 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 33485 win 7336 <nop,nop,timestamp 481717 481732>
11:40:30.741803 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 34009 win 7860 <nop,nop,timestamp 481717 481732>
11:40:30.741812 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 34533 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.742242 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 35057:35581(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742254 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 35581:36105(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742259 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 36105:36629(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742285 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 36629:37153(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742296 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 37153:37677(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742303 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 37677:38201(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742310 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 38201:38725(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742316 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 38725:39249(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742360 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 39249:39773(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742368 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 39773:40297(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742375 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 40297:40821(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742382 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 40821:41345(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742389 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 41345:41869(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742396 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 41869:42393(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742402 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 42393:42917(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742409 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 42917:43441(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742419 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 35581 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.742425 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 36629 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.742472 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 43441:43965(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742484 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 43965:44489(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742491 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 44489:45013(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742495 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 45013:45537(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742500 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 45537:46061(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742506 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 46061:46585(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742512 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 46585:47109(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742519 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 47109:47633(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742526 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 47633:48157(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742532 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 48157:48681(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742538 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 48681:49205(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742546 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 37677 win 8384 <nop,nop,timestamp 481717 481732>
11:40:30.742675 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 49205:49729(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742700 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 49729:50253(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742705 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 50253:50777(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742710 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 50777:51301(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742728 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 51301:51825(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742750 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 51825:52349(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742758 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 52349:52873(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742779 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 52873:53397(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.742792 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 53397:53921(524) ack 1 win 2920 <nop,nop,timestamp 481732 481717>
11:40:30.776776 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 53921 win 3782 <nop,nop,timestamp 481721 481732>
11:40:30.777213 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 53921:54445(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777241 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 54445:54969(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777249 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 54969:55493(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777285 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 55493:56017(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777297 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 56017:56541(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777303 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 56541:57065(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777308 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 57065:57589(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777314 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 57589:58113(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777320 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 58113:58637(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777326 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 58637:59161(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777353 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 59161:59685(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777360 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 59685:60209(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777364 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 60209:60733(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777368 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 60733:61257(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777513 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 61257 win 4192 <nop,nop,timestamp 481721 481741>
11:40:30.777822 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 61257:61781(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777841 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 61781:62305(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777867 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 62305:62829(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777875 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 62829:63353(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777881 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 63353:63877(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777888 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 63877:64401(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777912 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 64401:64925(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777920 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 64925:65449(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777927 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 65449:65973(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777933 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 65973:66497(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777961 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 66497:67021(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777969 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 67021:67545(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777976 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 67545:68069(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777982 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 68069:68593(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.777989 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 61781 win 4448 <nop,nop,timestamp 481721 481741>
11:40:30.778009 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 68593:69117(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.778022 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 69117:69641(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.778249 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 69641:70165(524) ack 1 win 2920 <nop,nop,timestamp 481741 481721>
11:40:30.817005 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 70165 win 986 <nop,nop,timestamp 481725 481741>
11:40:30.818112 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 70165:70689(524) ack 1 win 2920 <nop,nop,timestamp 481745 481725>
11:40:30.818152 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 70689:71213(524) ack 1 win 2920 <nop,nop,timestamp 481745 481725>
11:40:30.818164 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 71213:71737(524) ack 1 win 2920 <nop,nop,timestamp 481745 481725>
11:40:30.856928 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 71737 win 200 <nop,nop,timestamp 481729 481745>
11:40:31.074469 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 71737:72137(400) ack 1 win 2920 <nop,nop,timestamp 481771 481729>
11:40:31.075022 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 72137 win 1048 <nop,nop,timestamp 481750 481771>
11:40:31.075962 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 72137:72261(124) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.076011 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 72261:72785(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.076023 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 72785:73309(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.076032 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 73309:73833(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.076335 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 72785 win 1572 <nop,nop,timestamp 481750 481771>
11:40:31.077235 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 73833:74357(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.077267 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 74357:74881(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.077278 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 74881:75405(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.077286 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 75405:75929(524) ack 1 win 2920 <nop,nop,timestamp 481771 481750>
11:40:31.107000 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 75929 win 1250 <nop,nop,timestamp 481754 481771>
11:40:31.108014 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 75929:76453(524) ack 1 win 2920 <nop,nop,timestamp 481774 481754>
11:40:31.108069 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 76453:76977(524) ack 1 win 2920 <nop,nop,timestamp 481774 481754>
11:40:31.108087 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 76977:77501(524) ack 1 win 2920 <nop,nop,timestamp 481774 481754>
11:40:31.108100 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 77501:78025(524) ack 1 win 2920 <nop,nop,timestamp 481774 481754>
11:40:31.146969 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 78025 win 770 <nop,nop,timestamp 481758 481774>
11:40:31.147867 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 78025:78549(524) ack 1 win 2920 <nop,nop,timestamp 481778 481758>
11:40:31.147926 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 78549:79073(524) ack 1 win 2920 <nop,nop,timestamp 481778 481758>
11:40:31.186959 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79073 win 246 <nop,nop,timestamp 481762 481778>
11:40:31.404223 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 79073:79565(492) ack 1 win 2920 <nop,nop,timestamp 481804 481762>
11:40:31.404733 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79565 win 0 <nop,nop,timestamp 481783 481804>
11:40:31.624277 IP 10.10.0.2.47564 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 481826 481783>

*** win here is close to zero ***

11:40:31.624703 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79565 win 0 <nop,nop,timestamp 481805 481804>
11:40:32.063971 IP 10.10.0.2.47564 > 10.30.0.2.3002: . ack 1 win 2920 <nop,nop,timestamp 481870 481805>
11:40:32.064118 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79565 win 0 <nop,nop,timestamp 481849 481804>
11:40:32.747385 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79565 win 524 <nop,nop,timestamp 481919 481804>
11:40:32.748248 IP 10.10.0.2.47564 > 10.30.0.2.3002: P 79565:79597(32) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.748306 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 79597:80121(524) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.748648 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 79597 win 524 <nop,nop,timestamp 481919 481938>
11:40:32.748682 IP 10.30.0.2.3002 > 10.10.0.2.47564: . ack 80121 win 1048 <nop,nop,timestamp 481919 481938>
11:40:32.748846 IP 10.30.0.2.3002 > 10.10.0.2.47564: R 1:1(0) ack 80121 win 1048 <nop,nop,timestamp 481919 481938>
11:40:32.749442 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 80121:80645(524) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.749484 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 80645:81169(524) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.749524 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 81169:81693(524) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.749541 IP 10.10.0.2.47564 > 10.30.0.2.3002: . 81693:82217(524) ack 1 win 2920 <nop,nop,timestamp 481938 481919>
11:40:32.749786 IP 10.30.0.2.3002 > 10.10.0.2.47564: R 3876910230:3876910230(0) win 0
11:40:32.749894 IP 10.30.0.2.3002 > 10.10.0.2.47564: R 3876910230:3876910230(0) win 0
11:40:32.749927 IP 10.30.0.2.3002 > 10.10.0.2.47564: R 3876910230:3876910230(0) win 0
11:40:32.749943 IP 10.30.0.2.3002 > 10.10.0.2.47564: R 3876910230:3876910230(0) win 0
\end{lstlisting}

Теперь проведём такой же эксперимент на c4, запустив сервер win внутри программы screen или же в фоновом режиме (используя знак Амперсанда). Затем воспользуемся screen для запуска программы tcpdump на интерфейсе lo. После завершения подготовки запустим клиента на всё той же
машине c4. 
\begin{lstlisting}
c4:~# screen -h 2000

c4:~# ./win 3002 2 10 &
[1] 663

c4:~# netcat localhost 3002 </dev/zero

c4:~# tcpdump -n -i lo tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on lo, link-type EN10MB (Ethernet), capture size 96 bytes
11:54:30.165909 IP 127.0.0.1.36760 > 127.0.0.1.3002: S 4126728657:4126728657(0) win 32792 <mss 16396,sackOK,timestamp 565655 0,nop,wscale 1>
11:54:30.165929 IP 127.0.0.1.3002 > 127.0.0.1.36760: S 4135700332:4135700332(0) ack 4126728658 win 32768 <mss 16396,sackOK,timestamp 565655 565655,nop,wscale 1>
11:54:30.165945 IP 127.0.0.1.36760 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.166620 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 1:8193(8192) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.166630 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 8193 win 24576 <nop,nop,timestamp 565655 565655>
11:54:30.166757 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 8193:16385(8192) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.166763 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 16385 win 24576 <nop,nop,timestamp 565655 565655>
11:54:30.166902 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 16385:24577(8192) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.166912 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 24577 win 23120 <nop,nop,timestamp 565655 565655>
11:54:30.167071 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 24577:32769(8192) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.167299 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 32769:49153(16384) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.167516 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 49153:65537(16384) ack 1 win 16396 <nop,nop,timestamp 565655 565655>
11:54:30.168746 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 65537 win 2640 <nop,nop,timestamp 565661 565655>
11:54:30.387781 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 65537:70817(5280) ack 1 win 16396 <nop,nop,timestamp 565683 565661>
11:54:30.387826 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 70817 win 0 <nop,nop,timestamp 565683 565683>
11:54:30.607667 IP 127.0.0.1.36760 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 565704 565683>
11:54:30.607683 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 70817 win 0 <nop,nop,timestamp 565704 565683>
11:54:31.027627 IP 127.0.0.1.36760 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 565746 565704>
11:54:31.027645 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 70817 win 0 <nop,nop,timestamp 565746 565683>
11:54:31.867660 IP 127.0.0.1.36760 > 127.0.0.1.3002: . ack 1 win 16396 <nop,nop,timestamp 565830 565746>
11:54:31.867676 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 70817 win 0 <nop,nop,timestamp 565830 565683>
11:54:32.168624 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 70817 win 8420 <nop,nop,timestamp 565860 565683>
11:54:32.168645 IP 127.0.0.1.36760 > 127.0.0.1.3002: P 70817:81921(11104) ack 1 win 16396 <nop,nop,timestamp 565860 565860>
11:54:32.168659 IP 127.0.0.1.3002 > 127.0.0.1.36760: . ack 81921 win 2868 <nop,nop,timestamp 565860 565860>
11:54:32.169482 IP 127.0.0.1.3002 > 127.0.0.1.36760: R 1:1(0) ack 81921 win 24576 <nop,nop,timestamp 565860 565860>
\end{lstlisting}

\section{Окно отправителя}

На машине c5 установите задержку канала 100мс.

\begin{lstlisting}
*** c5/etc/delay configuration ***

#!/bin/sh
DELAY=100msec
[[ -z $1 ]] || DELAY=${1}msec
tc qdisc del dev eth0 root
tc qdisc add dev eth0 root handle 1:0 netem delay $DELAY
\end{lstlisting}

На машине c1 запускаем ping. Видно, что время ответа узла 10.40.0.2 действительно составляет 100мс.
\begin{lstlisting}
c1:~# ping 10.40.0.2
PING 10.40.0.2 (10.40.0.2) 56(84) bytes of data.
64 bytes from 10.40.0.2: icmp_seq=1 ttl=63 time=5.45 ms
64 bytes from 10.40.0.2: icmp_seq=2 ttl=63 time=1.08 ms
64 bytes from 10.40.0.2: icmp_seq=3 ttl=63 time=1.15 ms
64 bytes from 10.40.0.2: icmp_seq=4 ttl=63 time=1.27 ms
64 bytes from 10.40.0.2: icmp_seq=5 ttl=63 time=1.15 ms
64 bytes from 10.40.0.2: icmp_seq=6 ttl=63 time=1.30 ms
64 bytes from 10.40.0.2: icmp_seq=7 ttl=63 time=1.19 ms
64 bytes from 10.40.0.2: icmp_seq=8 ttl=63 time=1.19 ms
64 bytes from 10.40.0.2: icmp_seq=9 ttl=63 time=1.10 ms
64 bytes from 10.40.0.2: icmp_seq=10 ttl=63 time=1.18 ms
^C
--- 10.40.0.2 ping statistics ---
10 packets transmitted, 10 received, 0% packet loss, time 9091ms
rtt min/avg/max/mdev = 1.082/1.609/5.459/1.284 ms
\end{lstlisting}

Затем выполняем на c1 следующие команды

\begin{lstlisting}
c1:~# gcc -std=gnu99 -o nagle nagle.c
c1:~# ./a.out nodelay 10.40.0.2 9 1 20

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
12:30:34.069651 IP 10.10.0.2.34591 > 10.40.0.2.9: S 3285514627:3285514627(0) win 5840 <mss 1460,sackOK,timestamp 2537 0,nop,wscale 1>
12:30:34.070013 IP 10.40.0.2.9 > 10.10.0.2.34591: S 3275020194:3275020194(0) ack 3285514628 win 5792 <mss 1460,sackOK,timestamp 2536 2537,nop,wscale 1>
12:30:34.070253 IP 10.10.0.2.34591 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 2540 2536>
12:30:34.070544 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 2540 2536>
12:30:34.070789 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 101 win 2896 <nop,nop,timestamp 2536 2540>
12:30:34.077116 IP 10.10.0.2.34591 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 2540 2536>
12:30:34.077382 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 201 win 2896 <nop,nop,timestamp 2536 2540>
12:30:34.087197 IP 10.10.0.2.34591 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 2541 2536>
12:30:34.087571 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 301 win 2896 <nop,nop,timestamp 2536 2541>
12:30:34.097275 IP 10.10.0.2.34591 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 2542 2536>
12:30:34.097653 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 401 win 2896 <nop,nop,timestamp 2540 2542>
12:30:34.107264 IP 10.10.0.2.34591 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 2543 2540>
12:30:34.107672 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 501 win 2896 <nop,nop,timestamp 2541 2543>
12:30:34.117180 IP 10.10.0.2.34591 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 2544 2541>
12:30:34.117552 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 601 win 2896 <nop,nop,timestamp 2541 2544>
12:30:34.127353 IP 10.10.0.2.34591 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 2545 2541>
12:30:34.127743 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 701 win 2896 <nop,nop,timestamp 2542 2545>
12:30:34.137319 IP 10.10.0.2.34591 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 2546 2542>
12:30:34.137727 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 801 win 2896 <nop,nop,timestamp 2544 2546>
12:30:34.147270 IP 10.10.0.2.34591 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 2547 2544>
12:30:34.147793 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 901 win 2896 <nop,nop,timestamp 2545 2547>
12:30:34.157315 IP 10.10.0.2.34591 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 2548 2545>
12:30:34.157801 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1001 win 2896 <nop,nop,timestamp 2545 2548>
12:30:34.167381 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 2549 2545>
12:30:34.167906 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1101 win 2896 <nop,nop,timestamp 2545 2549>
12:30:34.177386 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 2550 2545>
12:30:34.177851 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1201 win 2896 <nop,nop,timestamp 2547 2550>
12:30:34.187286 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 2551 2547>
12:30:34.187682 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1301 win 2896 <nop,nop,timestamp 2549 2551>
12:30:34.197276 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 2552 2549>
12:30:34.197720 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1401 win 2896 <nop,nop,timestamp 2550 2552>
12:30:34.207318 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 2553 2550>
12:30:34.207837 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1501 win 2896 <nop,nop,timestamp 2550 2553>
12:30:34.217362 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 2554 2550>
12:30:34.217870 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1601 win 2896 <nop,nop,timestamp 2551 2554>
12:30:34.227386 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 2555 2551>
12:30:34.227894 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1701 win 2896 <nop,nop,timestamp 2552 2555>
12:30:34.237352 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 2556 2552>
12:30:34.237838 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1801 win 2896 <nop,nop,timestamp 2553 2556>
12:30:34.247423 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 2557 2553>
12:30:34.247960 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 1901 win 2896 <nop,nop,timestamp 2554 2557>
12:30:34.257336 IP 10.10.0.2.34591 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 2558 2554>
12:30:34.257761 IP 10.40.0.2.9 > 10.10.0.2.34591: . ack 2001 win 2896 <nop,nop,timestamp 2555 2558>
12:30:34.268566 IP 10.10.0.2.34591 > 10.40.0.2.9: F 2001:2001(0) ack 1 win 2920 <nop,nop,timestamp 2559 2555>
12:30:34.272391 IP 10.40.0.2.9 > 10.10.0.2.34591: F 1:1(0) ack 2002 win 2896 <nop,nop,timestamp 2556 2559>
12:30:34.272769 IP 10.10.0.2.34591 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 2559 2556>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./a.out nodelay 10.40.0.2 9 1 50

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
12:32:34.399525 IP 10.10.0.2.34592 > 10.40.0.2.9: S 868693403:868693403(0) win 5840 <mss 1460,sackOK,timestamp 14571 0,nop,wscale 1>
12:32:34.399709 IP 10.40.0.2.9 > 10.10.0.2.34592: S 867534812:867534812(0) ack 868693404 win 5792 <mss 1460,sackOK,timestamp 14569 14571,nop,wscale 1>
12:32:34.399894 IP 10.10.0.2.34592 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 14571 14569>
12:32:34.400006 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 14571 14569>
12:32:34.400134 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 101 win 2896 <nop,nop,timestamp 14569 14571>
12:32:34.401940 IP 10.10.0.2.34592 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 14573 14569>
12:32:34.402039 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 201 win 2896 <nop,nop,timestamp 14569 14573>
12:32:34.407204 IP 10.10.0.2.34592 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 14573 14569>
12:32:34.407328 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 301 win 2896 <nop,nop,timestamp 14569 14573>
12:32:34.417519 IP 10.10.0.2.34592 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 14575 14569>
12:32:34.417812 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 401 win 2896 <nop,nop,timestamp 14572 14575>
12:32:34.427927 IP 10.10.0.2.34592 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 14576 14572>
12:32:34.428303 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 501 win 2896 <nop,nop,timestamp 14572 14576>
12:32:34.438207 IP 10.10.0.2.34592 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 14577 14572>
12:32:34.438578 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 601 win 2896 <nop,nop,timestamp 14573 14577>
12:32:34.448321 IP 10.10.0.2.34592 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 14578 14573>
12:32:34.448751 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 701 win 2896 <nop,nop,timestamp 14574 14578>
12:32:34.458413 IP 10.10.0.2.34592 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 14579 14574>
12:32:34.458868 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 801 win 2896 <nop,nop,timestamp 14575 14579>
12:32:34.468359 IP 10.10.0.2.34592 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 14580 14575>
12:32:34.468879 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 901 win 2896 <nop,nop,timestamp 14576 14580>
12:32:34.478406 IP 10.10.0.2.34592 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 14581 14576>
12:32:34.478860 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1001 win 2896 <nop,nop,timestamp 14577 14581>
12:32:34.488258 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 14582 14577>
12:32:34.488740 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1101 win 2896 <nop,nop,timestamp 14578 14582>
12:32:34.498362 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 14583 14578>
12:32:34.498796 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1201 win 2896 <nop,nop,timestamp 14579 14583>
12:32:34.508195 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 14584 14579>
12:32:34.508677 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1301 win 2896 <nop,nop,timestamp 14580 14584>
12:32:34.518640 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 14585 14580>
12:32:34.519083 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1401 win 2896 <nop,nop,timestamp 14581 14585>
12:32:34.528607 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 14586 14581>
12:32:34.529100 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1501 win 2896 <nop,nop,timestamp 14582 14586>
12:32:34.538516 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 14587 14582>
12:32:34.538975 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1601 win 2896 <nop,nop,timestamp 14583 14587>
12:32:34.548535 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 14588 14583>
12:32:34.549099 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1701 win 2896 <nop,nop,timestamp 14584 14588>
12:32:34.558984 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 14589 14584>
12:32:34.559597 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1801 win 2896 <nop,nop,timestamp 14585 14589>
12:32:34.568769 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 14590 14585>
12:32:34.569307 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 1901 win 2896 <nop,nop,timestamp 14586 14590>
12:32:34.578877 IP 10.10.0.2.34592 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 14591 14586>
12:32:34.579505 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2001 win 2896 <nop,nop,timestamp 14588 14591>
12:32:34.588626 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 14592 14588>
12:32:34.589158 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2101 win 2896 <nop,nop,timestamp 14588 14592>
12:32:34.598422 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 14593 14588>
12:32:34.598896 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2201 win 2896 <nop,nop,timestamp 14589 14593>
12:32:34.608604 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 14594 14589>
12:32:34.609111 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2301 win 2896 <nop,nop,timestamp 14590 14594>
12:32:34.618844 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 14595 14590>
12:32:34.619474 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2401 win 2896 <nop,nop,timestamp 14591 14595>
12:32:34.628831 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 14596 14591>
12:32:34.629313 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2501 win 2896 <nop,nop,timestamp 14591 14596>
12:32:34.638528 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 14597 14591>
12:32:34.638983 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2601 win 2896 <nop,nop,timestamp 14593 14597>
12:32:34.648512 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 14598 14593>
12:32:34.649012 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2701 win 2896 <nop,nop,timestamp 14594 14598>
12:32:34.658689 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 14599 14594>
12:32:34.659263 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2801 win 2896 <nop,nop,timestamp 14595 14599>
12:32:34.668717 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 14600 14595>
12:32:34.669305 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 2901 win 2896 <nop,nop,timestamp 14596 14600>
12:32:34.678651 IP 10.10.0.2.34592 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 14601 14596>
12:32:34.679272 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3001 win 2896 <nop,nop,timestamp 14597 14601>
12:32:34.688916 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3001:3101(100) ack 1 win 2920 <nop,nop,timestamp 14602 14597>
12:32:34.689666 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3101 win 2896 <nop,nop,timestamp 14598 14602>
12:32:34.699123 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3101:3201(100) ack 1 win 2920 <nop,nop,timestamp 14603 14598>
12:32:34.699714 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3201 win 2896 <nop,nop,timestamp 14598 14603>
12:32:34.708258 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3201:3301(100) ack 1 win 2920 <nop,nop,timestamp 14604 14598>
12:32:34.708818 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3301 win 2896 <nop,nop,timestamp 14600 14604>
12:32:34.718701 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3301:3401(100) ack 1 win 2920 <nop,nop,timestamp 14605 14600>
12:32:34.719249 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3401 win 2896 <nop,nop,timestamp 14601 14605>
12:32:34.728736 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3401:3501(100) ack 1 win 2920 <nop,nop,timestamp 14606 14601>
12:32:34.729324 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3501 win 2896 <nop,nop,timestamp 14602 14606>
12:32:34.738780 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3501:3601(100) ack 1 win 2920 <nop,nop,timestamp 14607 14602>
12:32:34.739296 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3601 win 2896 <nop,nop,timestamp 14603 14607>
12:32:34.748681 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3601:3701(100) ack 1 win 2920 <nop,nop,timestamp 14608 14603>
12:32:34.749234 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3701 win 2896 <nop,nop,timestamp 14604 14608>
12:32:34.758793 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3701:3801(100) ack 1 win 2920 <nop,nop,timestamp 14609 14604>
12:32:34.759376 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3801 win 2896 <nop,nop,timestamp 14605 14609>
12:32:34.768658 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3801:3901(100) ack 1 win 2920 <nop,nop,timestamp 14610 14605>
12:32:34.769103 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 3901 win 2896 <nop,nop,timestamp 14606 14610>
12:32:34.778311 IP 10.10.0.2.34592 > 10.40.0.2.9: P 3901:4001(100) ack 1 win 2920 <nop,nop,timestamp 14611 14606>
12:32:34.778831 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4001 win 2896 <nop,nop,timestamp 14608 14611>
12:32:34.788792 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4001:4101(100) ack 1 win 2920 <nop,nop,timestamp 14612 14608>
12:32:34.789358 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4101 win 2896 <nop,nop,timestamp 14608 14612>
12:32:34.798684 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4101:4201(100) ack 1 win 2920 <nop,nop,timestamp 14613 14608>
12:32:34.799131 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4201 win 2896 <nop,nop,timestamp 14609 14613>
12:32:34.808494 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4201:4301(100) ack 1 win 2920 <nop,nop,timestamp 14614 14609>
12:32:34.809047 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4301 win 2896 <nop,nop,timestamp 14610 14614>
12:32:34.818803 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4301:4401(100) ack 1 win 2920 <nop,nop,timestamp 14615 14610>
12:32:34.819256 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4401 win 2896 <nop,nop,timestamp 14611 14615>
12:32:34.828506 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4401:4501(100) ack 1 win 2920 <nop,nop,timestamp 14616 14611>
12:32:34.828964 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4501 win 2896 <nop,nop,timestamp 14611 14616>
12:32:34.838473 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4501:4601(100) ack 1 win 2920 <nop,nop,timestamp 14617 14611>
12:32:34.838925 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4601 win 2896 <nop,nop,timestamp 14613 14617>
12:32:34.848562 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4601:4701(100) ack 1 win 2920 <nop,nop,timestamp 14618 14613>
12:32:34.849120 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4701 win 2896 <nop,nop,timestamp 14614 14618>
12:32:34.858792 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4701:4801(100) ack 1 win 2920 <nop,nop,timestamp 14619 14614>
12:32:34.859349 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4801 win 2896 <nop,nop,timestamp 14615 14619>
12:32:34.868644 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4801:4901(100) ack 1 win 2920 <nop,nop,timestamp 14620 14615>
12:32:34.869035 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 4901 win 2896 <nop,nop,timestamp 14616 14620>
12:32:34.878235 IP 10.10.0.2.34592 > 10.40.0.2.9: P 4901:5001(100) ack 1 win 2920 <nop,nop,timestamp 14621 14616>
12:32:34.878633 IP 10.40.0.2.9 > 10.10.0.2.34592: . ack 5001 win 2896 <nop,nop,timestamp 14617 14621>
12:32:34.890262 IP 10.10.0.2.34592 > 10.40.0.2.9: F 5001:5001(0) ack 1 win 2920 <nop,nop,timestamp 14622 14617>
12:32:34.894395 IP 10.40.0.2.9 > 10.10.0.2.34592: F 1:1(0) ack 5002 win 2896 <nop,nop,timestamp 14618 14622>
12:32:34.894752 IP 10.10.0.2.34592 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 14622 14618>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./a.out nodelay 10.40.0.2 9 1 100

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
12:33:55.532363 IP 10.10.0.2.34593 > 10.40.0.2.9: S 2135293241:2135293241(0) win 5840 <mss 1460,sackOK,timestamp 22683 0,nop,wscale 1>
12:33:55.532689 IP 10.40.0.2.9 > 10.10.0.2.34593: S 2134758030:2134758030(0) ack 2135293242 win 5792 <mss 1460,sackOK,timestamp 22682 22683,nop,wscale 1>
12:33:55.533038 IP 10.10.0.2.34593 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 22683 22682>
12:33:55.533559 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 22683 22682>
12:33:55.533887 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 101 win 2896 <nop,nop,timestamp 22682 22683>
12:33:55.537192 IP 10.10.0.2.34593 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 22686 22682>
12:33:55.537499 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 201 win 2896 <nop,nop,timestamp 22682 22686>
12:33:55.547755 IP 10.10.0.2.34593 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 22688 22682>
12:33:55.548035 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 301 win 2896 <nop,nop,timestamp 22682 22688>
12:33:55.557985 IP 10.10.0.2.34593 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 22689 22682>
12:33:55.558470 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 401 win 2896 <nop,nop,timestamp 22686 22689>
12:33:55.568287 IP 10.10.0.2.34593 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 22690 22686>
12:33:55.568589 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 501 win 2896 <nop,nop,timestamp 22686 22690>
12:33:55.578178 IP 10.10.0.2.34593 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 22691 22686>
12:33:55.578636 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 601 win 2896 <nop,nop,timestamp 22687 22691>
12:33:55.588313 IP 10.10.0.2.34593 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 22692 22687>
12:33:55.588626 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 701 win 2896 <nop,nop,timestamp 22687 22692>
12:33:55.598304 IP 10.10.0.2.34593 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 22693 22687>
12:33:55.598845 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 801 win 2896 <nop,nop,timestamp 22687 22693>
12:33:55.608649 IP 10.10.0.2.34593 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 22694 22687>
12:33:55.609140 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 901 win 2896 <nop,nop,timestamp 22691 22694>
12:33:55.618467 IP 10.10.0.2.34593 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 22695 22691>
12:33:55.618964 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1001 win 2896 <nop,nop,timestamp 22691 22695>
12:33:55.628580 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 22696 22691>
12:33:55.629158 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1101 win 2896 <nop,nop,timestamp 22693 22696>
12:33:55.638620 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 22697 22693>
12:33:55.639030 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1201 win 2896 <nop,nop,timestamp 22694 22697>
12:33:55.648249 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 22698 22694>
12:33:55.648703 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1301 win 2896 <nop,nop,timestamp 22695 22698>
12:33:55.658478 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 22699 22695>
12:33:55.659018 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1401 win 2896 <nop,nop,timestamp 22696 22699>
12:33:55.668606 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 22700 22696>
12:33:55.669086 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1501 win 2896 <nop,nop,timestamp 22696 22700>
12:33:55.678542 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 22701 22696>
12:33:55.679059 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1601 win 2896 <nop,nop,timestamp 22697 22701>
12:33:55.688575 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 22702 22697>
12:33:55.689073 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1701 win 2896 <nop,nop,timestamp 22698 22702>
12:33:55.698424 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 22703 22698>
12:33:55.698962 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1801 win 2896 <nop,nop,timestamp 22699 22703>
12:33:55.708596 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 22704 22699>
12:33:55.709160 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 1901 win 2896 <nop,nop,timestamp 22700 22704>
12:33:55.718749 IP 10.10.0.2.34593 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 22705 22700>
12:33:55.719315 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2001 win 2896 <nop,nop,timestamp 22701 22705>
12:33:55.728818 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 22706 22701>
12:33:55.729406 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2101 win 2896 <nop,nop,timestamp 22702 22706>
12:33:55.738933 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 22707 22702>
12:33:55.739453 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2201 win 2896 <nop,nop,timestamp 22703 22707>
12:33:55.748552 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 22708 22703>
12:33:55.748895 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2301 win 2896 <nop,nop,timestamp 22704 22708>
12:33:55.758258 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 22709 22704>
12:33:55.758625 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2401 win 2896 <nop,nop,timestamp 22705 22709>
12:33:55.768395 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 22710 22705>
12:33:55.768783 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2501 win 2896 <nop,nop,timestamp 22706 22710>
12:33:55.778473 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 22711 22706>
12:33:55.778882 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2601 win 2896 <nop,nop,timestamp 22707 22711>
12:33:55.788381 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 22712 22707>
12:33:55.788789 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2701 win 2896 <nop,nop,timestamp 22708 22712>
12:33:55.798434 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 22713 22708>
12:33:55.798970 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2801 win 2896 <nop,nop,timestamp 22709 22713>
12:33:55.808724 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 22714 22709>
12:33:55.809165 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 2901 win 2896 <nop,nop,timestamp 22710 22714>
12:33:55.818357 IP 10.10.0.2.34593 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 22715 22710>
12:33:55.818820 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3001 win 2896 <nop,nop,timestamp 22711 22715>
12:33:55.828705 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3001:3101(100) ack 1 win 2920 <nop,nop,timestamp 22716 22711>
12:33:55.829275 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3101 win 2896 <nop,nop,timestamp 22712 22716>
12:33:55.839006 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3101:3201(100) ack 1 win 2920 <nop,nop,timestamp 22717 22712>
12:33:55.839531 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3201 win 2896 <nop,nop,timestamp 22713 22717>
12:33:55.848350 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3201:3301(100) ack 1 win 2920 <nop,nop,timestamp 22718 22713>
12:33:55.848760 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3301 win 2896 <nop,nop,timestamp 22714 22718>
12:33:55.858335 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3301:3401(100) ack 1 win 2920 <nop,nop,timestamp 22719 22714>
12:33:55.858821 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3401 win 2896 <nop,nop,timestamp 22715 22719>
12:33:55.868547 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3401:3501(100) ack 1 win 2920 <nop,nop,timestamp 22720 22715>
12:33:55.869079 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3501 win 2896 <nop,nop,timestamp 22716 22720>
12:33:55.878669 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3501:3601(100) ack 1 win 2920 <nop,nop,timestamp 22721 22716>
12:33:55.879245 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3601 win 2896 <nop,nop,timestamp 22717 22721>
12:33:55.888649 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3601:3701(100) ack 1 win 2920 <nop,nop,timestamp 22722 22717>
12:33:55.889125 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3701 win 2896 <nop,nop,timestamp 22718 22722>
12:33:55.898490 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3701:3801(100) ack 1 win 2920 <nop,nop,timestamp 22723 22718>
12:33:55.899036 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3801 win 2896 <nop,nop,timestamp 22719 22723>
12:33:55.908386 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3801:3901(100) ack 1 win 2920 <nop,nop,timestamp 22724 22719>
12:33:55.908916 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 3901 win 2896 <nop,nop,timestamp 22720 22724>
12:33:55.918307 IP 10.10.0.2.34593 > 10.40.0.2.9: P 3901:4001(100) ack 1 win 2920 <nop,nop,timestamp 22725 22720>
12:33:55.918751 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4001 win 2896 <nop,nop,timestamp 22721 22725>
12:33:55.928259 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4001:4101(100) ack 1 win 2920 <nop,nop,timestamp 22726 22721>
12:33:55.928789 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4101 win 2896 <nop,nop,timestamp 22722 22726>
12:33:55.938537 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4101:4201(100) ack 1 win 2920 <nop,nop,timestamp 22727 22722>
12:33:55.938968 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4201 win 2896 <nop,nop,timestamp 22723 22727>
12:33:55.948444 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4201:4301(100) ack 1 win 2920 <nop,nop,timestamp 22728 22723>
12:33:55.948885 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4301 win 2896 <nop,nop,timestamp 22724 22728>
12:33:55.958571 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4301:4401(100) ack 1 win 2920 <nop,nop,timestamp 22729 22724>
12:33:55.959301 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4401 win 2896 <nop,nop,timestamp 22725 22729>
12:33:55.968979 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4401:4501(100) ack 1 win 2920 <nop,nop,timestamp 22730 22725>
12:33:55.969504 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4501 win 2896 <nop,nop,timestamp 22726 22730>
12:33:55.978549 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4501:4601(100) ack 1 win 2920 <nop,nop,timestamp 22731 22726>
12:33:55.979006 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4601 win 2896 <nop,nop,timestamp 22727 22731>
12:33:55.988376 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4601:4701(100) ack 1 win 2920 <nop,nop,timestamp 22732 22727>
12:33:55.988857 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4701 win 2896 <nop,nop,timestamp 22729 22732>
12:33:55.998555 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4701:4801(100) ack 1 win 2920 <nop,nop,timestamp 22733 22729>
12:33:55.999108 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4801 win 2896 <nop,nop,timestamp 22730 22733>
12:33:56.008585 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4801:4901(100) ack 1 win 2920 <nop,nop,timestamp 22734 22730>
12:33:56.009096 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 4901 win 2896 <nop,nop,timestamp 22731 22734>
12:33:56.018512 IP 10.10.0.2.34593 > 10.40.0.2.9: P 4901:5001(100) ack 1 win 2920 <nop,nop,timestamp 22735 22731>
12:33:56.018937 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5001 win 2896 <nop,nop,timestamp 22731 22735>
12:33:56.028554 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5001:5101(100) ack 1 win 2920 <nop,nop,timestamp 22736 22731>
12:33:56.029095 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5101 win 2896 <nop,nop,timestamp 22733 22736>
12:33:56.038847 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5101:5201(100) ack 1 win 2920 <nop,nop,timestamp 22737 22733>
12:33:56.039517 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5201 win 2896 <nop,nop,timestamp 22734 22737>
12:33:56.048634 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5201:5301(100) ack 1 win 2920 <nop,nop,timestamp 22738 22734>
12:33:56.049182 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5301 win 2896 <nop,nop,timestamp 22735 22738>
12:33:56.058547 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5301:5401(100) ack 1 win 2920 <nop,nop,timestamp 22739 22735>
12:33:56.059096 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5401 win 2896 <nop,nop,timestamp 22736 22739>
12:33:56.068742 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5401:5501(100) ack 1 win 2920 <nop,nop,timestamp 22740 22736>
12:33:56.069271 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5501 win 2896 <nop,nop,timestamp 22736 22740>
12:33:56.078588 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5501:5601(100) ack 1 win 2920 <nop,nop,timestamp 22741 22736>
12:33:56.079160 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5601 win 2896 <nop,nop,timestamp 22738 22741>
12:33:56.088492 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5601:5701(100) ack 1 win 2920 <nop,nop,timestamp 22742 22738>
12:33:56.089000 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5701 win 2896 <nop,nop,timestamp 22739 22742>
12:33:56.098694 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5701:5801(100) ack 1 win 2920 <nop,nop,timestamp 22743 22739>
12:33:56.099180 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5801 win 2896 <nop,nop,timestamp 22739 22743>
12:33:56.108470 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5801:5901(100) ack 1 win 2920 <nop,nop,timestamp 22744 22739>
12:33:56.108932 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 5901 win 2896 <nop,nop,timestamp 22740 22744>
12:33:56.118498 IP 10.10.0.2.34593 > 10.40.0.2.9: P 5901:6001(100) ack 1 win 2920 <nop,nop,timestamp 22745 22740>
12:33:56.119025 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6001 win 2896 <nop,nop,timestamp 22741 22745>
12:33:56.128915 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6001:6101(100) ack 1 win 2920 <nop,nop,timestamp 22746 22741>
12:33:56.129619 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6101 win 2896 <nop,nop,timestamp 22742 22746>
12:33:56.139108 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6101:6201(100) ack 1 win 2920 <nop,nop,timestamp 22747 22742>
12:33:56.139591 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6201 win 2896 <nop,nop,timestamp 22742 22747>
12:33:56.148188 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6201:6301(100) ack 1 win 2920 <nop,nop,timestamp 22748 22742>
12:33:56.148700 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6301 win 2896 <nop,nop,timestamp 22744 22748>
12:33:56.158685 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6301:6401(100) ack 1 win 2920 <nop,nop,timestamp 22749 22744>
12:33:56.159306 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6401 win 2896 <nop,nop,timestamp 22745 22749>
12:33:56.168892 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6401:6501(100) ack 1 win 2920 <nop,nop,timestamp 22750 22745>
12:33:56.169473 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6501 win 2896 <nop,nop,timestamp 22746 22750>
12:33:56.178740 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6501:6601(100) ack 1 win 2920 <nop,nop,timestamp 22751 22746>
12:33:56.179270 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6601 win 2896 <nop,nop,timestamp 22748 22751>
12:33:56.188658 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6601:6701(100) ack 1 win 2920 <nop,nop,timestamp 22752 22748>
12:33:56.189308 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6701 win 2896 <nop,nop,timestamp 22748 22752>
12:33:56.198997 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6701:6801(100) ack 1 win 2920 <nop,nop,timestamp 22753 22748>
12:33:56.199589 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6801 win 2896 <nop,nop,timestamp 22750 22753>
12:33:56.208545 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6801:6901(100) ack 1 win 2920 <nop,nop,timestamp 22754 22750>
12:33:56.209119 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 6901 win 2896 <nop,nop,timestamp 22751 22754>
12:33:56.218581 IP 10.10.0.2.34593 > 10.40.0.2.9: P 6901:7001(100) ack 1 win 2920 <nop,nop,timestamp 22755 22751>
12:33:56.219130 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7001 win 2896 <nop,nop,timestamp 22751 22755>
12:33:56.228569 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7001:7101(100) ack 1 win 2920 <nop,nop,timestamp 22756 22751>
12:33:56.229094 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7101 win 2896 <nop,nop,timestamp 22752 22756>
12:33:56.238554 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7101:7201(100) ack 1 win 2920 <nop,nop,timestamp 22757 22752>
12:33:56.239032 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7201 win 2896 <nop,nop,timestamp 22753 22757>
12:33:56.248209 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7201:7301(100) ack 1 win 2920 <nop,nop,timestamp 22758 22753>
12:33:56.248615 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7301 win 2896 <nop,nop,timestamp 22754 22758>
12:33:56.258327 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7301:7401(100) ack 1 win 2920 <nop,nop,timestamp 22759 22754>
12:33:56.258921 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7401 win 2896 <nop,nop,timestamp 22755 22759>
12:33:56.268644 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7401:7501(100) ack 1 win 2920 <nop,nop,timestamp 22760 22755>
12:33:56.269180 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7501 win 2896 <nop,nop,timestamp 22756 22760>
12:33:56.278488 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7501:7601(100) ack 1 win 2920 <nop,nop,timestamp 22761 22756>
12:33:56.279035 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7601 win 2896 <nop,nop,timestamp 22757 22761>
12:33:56.288640 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7601:7701(100) ack 1 win 2920 <nop,nop,timestamp 22762 22757>
12:33:56.289199 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7701 win 2896 <nop,nop,timestamp 22758 22762>
12:33:56.298730 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7701:7801(100) ack 1 win 2920 <nop,nop,timestamp 22763 22758>
12:33:56.299287 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7801 win 2896 <nop,nop,timestamp 22759 22763>
12:33:56.308572 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7801:7901(100) ack 1 win 2920 <nop,nop,timestamp 22764 22759>
12:33:56.309110 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 7901 win 2896 <nop,nop,timestamp 22760 22764>
12:33:56.318553 IP 10.10.0.2.34593 > 10.40.0.2.9: P 7901:8001(100) ack 1 win 2920 <nop,nop,timestamp 22765 22760>
12:33:56.319081 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8001 win 2896 <nop,nop,timestamp 22761 22765>
12:33:56.328611 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8001:8101(100) ack 1 win 2920 <nop,nop,timestamp 22766 22761>
12:33:56.329140 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8101 win 2896 <nop,nop,timestamp 22762 22766>
12:33:56.338607 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8101:8201(100) ack 1 win 2920 <nop,nop,timestamp 22767 22762>
12:33:56.339096 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8201 win 2896 <nop,nop,timestamp 22763 22767>
12:33:56.348558 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8201:8301(100) ack 1 win 2920 <nop,nop,timestamp 22768 22763>
12:33:56.349100 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8301 win 2896 <nop,nop,timestamp 22764 22768>
12:33:56.358610 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8301:8401(100) ack 1 win 2920 <nop,nop,timestamp 22769 22764>
12:33:56.359097 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8401 win 2896 <nop,nop,timestamp 22765 22769>
12:33:56.368569 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8401:8501(100) ack 1 win 2920 <nop,nop,timestamp 22770 22765>
12:33:56.369069 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8501 win 2896 <nop,nop,timestamp 22766 22770>
12:33:56.378684 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8501:8601(100) ack 1 win 2920 <nop,nop,timestamp 22771 22766>
12:33:56.379070 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8601 win 2896 <nop,nop,timestamp 22767 22771>
12:33:56.388471 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8601:8701(100) ack 1 win 2920 <nop,nop,timestamp 22772 22767>
12:33:56.388954 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8701 win 2896 <nop,nop,timestamp 22768 22772>
12:33:56.398697 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8701:8801(100) ack 1 win 2920 <nop,nop,timestamp 22773 22768>
12:33:56.399141 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8801 win 2896 <nop,nop,timestamp 22769 22773>
12:33:56.408418 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8801:8901(100) ack 1 win 2920 <nop,nop,timestamp 22774 22769>
12:33:56.408850 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 8901 win 2896 <nop,nop,timestamp 22770 22774>
12:33:56.418528 IP 10.10.0.2.34593 > 10.40.0.2.9: P 8901:9001(100) ack 1 win 2920 <nop,nop,timestamp 22775 22770>
12:33:56.419103 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9001 win 2896 <nop,nop,timestamp 22771 22775>
12:33:56.428775 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9001:9101(100) ack 1 win 2920 <nop,nop,timestamp 22776 22771>
12:33:56.429218 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9101 win 2896 <nop,nop,timestamp 22772 22776>
12:33:56.438422 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9101:9201(100) ack 1 win 2920 <nop,nop,timestamp 22777 22772>
12:33:56.438923 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9201 win 2896 <nop,nop,timestamp 22773 22777>
12:33:56.448540 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9201:9301(100) ack 1 win 2920 <nop,nop,timestamp 22778 22773>
12:33:56.448974 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9301 win 2896 <nop,nop,timestamp 22774 22778>
12:33:56.458545 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9301:9401(100) ack 1 win 2920 <nop,nop,timestamp 22779 22774>
12:33:56.459028 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9401 win 2896 <nop,nop,timestamp 22775 22779>
12:33:56.468743 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9401:9501(100) ack 1 win 2920 <nop,nop,timestamp 22780 22775>
12:33:56.469261 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9501 win 2896 <nop,nop,timestamp 22776 22780>
12:33:56.478669 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9501:9601(100) ack 1 win 2920 <nop,nop,timestamp 22781 22776>
12:33:56.479156 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9601 win 2896 <nop,nop,timestamp 22777 22781>
12:33:56.488460 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9601:9701(100) ack 1 win 2920 <nop,nop,timestamp 22782 22777>
12:33:56.489137 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9701 win 2896 <nop,nop,timestamp 22778 22782>
12:33:56.498721 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9701:9801(100) ack 1 win 2920 <nop,nop,timestamp 22783 22778>
12:33:56.499258 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9801 win 2896 <nop,nop,timestamp 22780 22783>
12:33:56.508622 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9801:9901(100) ack 1 win 2920 <nop,nop,timestamp 22784 22780>
12:33:56.509075 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 9901 win 2896 <nop,nop,timestamp 22780 22784>
12:33:56.518612 IP 10.10.0.2.34593 > 10.40.0.2.9: P 9901:10001(100) ack 1 win 2920 <nop,nop,timestamp 22785 22780>
12:33:56.519288 IP 10.40.0.2.9 > 10.10.0.2.34593: . ack 10001 win 2896 <nop,nop,timestamp 22782 22785>
12:33:56.529997 IP 10.10.0.2.34593 > 10.40.0.2.9: F 10001:10001(0) ack 1 win 2920 <nop,nop,timestamp 22786 22782>
12:33:56.534460 IP 10.40.0.2.9 > 10.10.0.2.34593: F 1:1(0) ack 10002 win 2896 <nop,nop,timestamp 22782 22786>
12:33:56.534831 IP 10.10.0.2.34593 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 22786 22782>
\end{lstlisting}

\section{Нейгл и Мишналь}

Без задержки, алгоритм Нейгла работает (он включен по умолчанию).

\begin{lstlisting}
c1:~# ./nagle default 10.40.0.2 9 -1 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
18:54:52.489277 IP 10.10.0.2.49915 > 10.40.0.2.9: S 2829085622:2829085622(0) win 5840 <mss 1460,sackOK,timestamp 64775 0,nop,wscale 1>
18:54:52.489754 IP 10.40.0.2.9 > 10.10.0.2.49915: S 2819913788:2819913788(0) ack 2829085623 win 5792 <mss 1460,sackOK,timestamp 64775 64775,nop,wscale 1>
18:54:52.490096 IP 10.10.0.2.49915 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.490531 IP 10.10.0.2.49915 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.490858 IP 10.40.0.2.9 > 10.10.0.2.49915: . ack 101 win 2896 <nop,nop,timestamp 64775 64775>
18:54:52.491187 IP 10.10.0.2.49915 > 10.40.0.2.9: P 101:1101(1000) ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.491523 IP 10.40.0.2.9 > 10.10.0.2.49915: . ack 1101 win 3896 <nop,nop,timestamp 64775 64775>
18:54:52.491742 IP 10.10.0.2.49915 > 10.40.0.2.9: P 1101:2501(1400) ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.492054 IP 10.40.0.2.9 > 10.10.0.2.49915: . ack 2501 win 5344 <nop,nop,timestamp 64775 64775>
18:54:52.492292 IP 10.10.0.2.49915 > 10.40.0.2.9: P 2501:3001(500) ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.492518 IP 10.40.0.2.9 > 10.10.0.2.49915: . ack 3001 win 6744 <nop,nop,timestamp 64775 64775>
18:54:52.493146 IP 10.10.0.2.49915 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 64775 64775>
18:54:52.505524 IP 10.40.0.2.9 > 10.10.0.2.49915: F 1:1(0) ack 3002 win 6744 <nop,nop,timestamp 64775 64775>
18:54:52.505930 IP 10.10.0.2.49915 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 64779 64775>
\end{lstlisting}

Почти без задержки, алгоритм Нейгла работает (он включен по умолчанию).

\begin{lstlisting}
c1:~# ./nagle default 10.40.0.2 9 0 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
18:53:50.363953 IP 10.10.0.2.41992 > 10.40.0.2.9: S 1838366379:1838366379(0) win 5840 <mss 1460,sackOK,timestamp 58564 0,nop,wscale 1>
18:53:50.364181 IP 10.40.0.2.9 > 10.10.0.2.41992: S 1841224343:1841224343(0) ack 1838366380 win 5792 <mss 1460,sackOK,timestamp 58563 58564,nop,wscale 1>
18:53:50.364279 IP 10.10.0.2.41992 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 58564 58563>
18:53:50.364340 IP 10.10.0.2.41992 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 58564 58563>
18:53:50.364425 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 101 win 2896 <nop,nop,timestamp 58563 58564>
18:53:50.369575 IP 10.10.0.2.41992 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 58567 58563>
18:53:50.369748 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 201 win 2896 <nop,nop,timestamp 58563 58567>
18:53:50.378882 IP 10.10.0.2.41992 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 58568 58563>
18:53:50.379086 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 301 win 2896 <nop,nop,timestamp 58563 58568>
18:53:50.379238 IP 10.10.0.2.41992 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 58568 58563>
18:53:50.379433 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 401 win 2896 <nop,nop,timestamp 58563 58568>
18:53:50.389415 IP 10.10.0.2.41992 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 58569 58563>
18:53:50.389609 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 501 win 2896 <nop,nop,timestamp 58566 58569>
18:53:50.389730 IP 10.10.0.2.41992 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 58569 58566>
18:53:50.389824 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 601 win 2896 <nop,nop,timestamp 58566 58569>
18:53:50.389889 IP 10.10.0.2.41992 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 58569 58566>
18:53:50.389979 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 701 win 2896 <nop,nop,timestamp 58566 58569>
18:53:50.399706 IP 10.10.0.2.41992 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 58570 58566>
18:53:50.400126 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 801 win 2896 <nop,nop,timestamp 58567 58570>
18:53:50.400570 IP 10.10.0.2.41992 > 10.40.0.2.9: P 801:1101(300) ack 1 win 2920 <nop,nop,timestamp 58570 58567>
18:53:50.400971 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 1101 win 3432 <nop,nop,timestamp 58567 58570>
18:53:50.410566 IP 10.10.0.2.41992 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 58571 58567>
18:53:50.411083 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 1201 win 3432 <nop,nop,timestamp 58567 58571>
18:53:50.411352 IP 10.10.0.2.41992 > 10.40.0.2.9: P 1201:1601(400) ack 1 win 2920 <nop,nop,timestamp 58571 58567>
18:53:50.411685 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 1601 win 3968 <nop,nop,timestamp 58567 58571>
18:53:50.411923 IP 10.10.0.2.41992 > 10.40.0.2.9: P 1601:1901(300) ack 1 win 2920 <nop,nop,timestamp 58571 58567>
18:53:50.412224 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 1901 win 4504 <nop,nop,timestamp 58567 58571>
18:53:50.420467 IP 10.10.0.2.41992 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 58572 58567>
18:53:50.420916 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 2001 win 4504 <nop,nop,timestamp 58567 58572>
18:53:50.421347 IP 10.10.0.2.41992 > 10.40.0.2.9: P 2001:2401(400) ack 1 win 2920 <nop,nop,timestamp 58572 58567>
18:53:50.421765 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 2401 win 5040 <nop,nop,timestamp 58567 58572>
18:53:50.430467 IP 10.10.0.2.41992 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 58573 58567>
18:53:50.430848 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 2501 win 5040 <nop,nop,timestamp 58571 58573>
18:53:50.431204 IP 10.10.0.2.41992 > 10.40.0.2.9: P 2501:2801(300) ack 1 win 2920 <nop,nop,timestamp 58573 58571>
18:53:50.431667 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 2801 win 5040 <nop,nop,timestamp 58571 58573>
18:53:50.439805 IP 10.10.0.2.41992 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 58574 58571>
18:53:50.440341 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 2901 win 5040 <nop,nop,timestamp 58571 58574>
18:53:50.440713 IP 10.10.0.2.41992 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 58574 58571>
18:53:50.441117 IP 10.10.0.2.41992 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 58574 58571>
18:53:50.441151 IP 10.40.0.2.9 > 10.10.0.2.41992: . ack 3001 win 5040 <nop,nop,timestamp 58571 58574>
18:53:50.445318 IP 10.40.0.2.9 > 10.10.0.2.41992: F 1:1(0) ack 3002 win 5040 <nop,nop,timestamp 58571 58574>
18:53:50.445672 IP 10.10.0.2.41992 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 58574 58571>
\end{lstlisting}

Маленькая задержка, алгоритм Нейгла работает частично

\begin{lstlisting}
c1:~# ./nagle default 10.40.0.2 9 3 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:37:25.686058 IP 10.10.0.2.47265 > 10.40.0.2.9: S 1570275637:1570275637(0) win 5840 <mss 1460,sackOK,timestamp 85488 0,nop,wscale 1>
13:37:25.696840 IP 10.40.0.2.9 > 10.10.0.2.47265: S 1572340604:1572340604(0) ack 1570275638 win 5792 <mss 1460,sackOK,timestamp 85489 85488,nop,wscale 1>
13:37:25.697038 IP 10.10.0.2.47265 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 85491 85489>
13:37:25.697331 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 85491 85489>
13:37:25.697486 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 101 win 2896 <nop,nop,timestamp 85489 85491>
13:37:25.706346 IP 10.10.0.2.47265 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 85493 85489>
13:37:25.706553 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 201 win 2896 <nop,nop,timestamp 85489 85493>
13:37:25.713882 IP 10.10.0.2.47265 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 85493 85489>
13:37:25.714082 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 301 win 2896 <nop,nop,timestamp 85489 85493>
13:37:25.723956 IP 10.10.0.2.47265 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 85494 85489>
13:37:25.724234 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 401 win 2896 <nop,nop,timestamp 85492 85494>
13:37:25.733939 IP 10.10.0.2.47265 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 85495 85492>
13:37:25.734146 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 501 win 2896 <nop,nop,timestamp 85493 85495>
13:37:25.743991 IP 10.10.0.2.47265 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 85496 85493>
13:37:25.744262 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 601 win 2896 <nop,nop,timestamp 85494 85496>
13:37:25.753966 IP 10.10.0.2.47265 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 85497 85494>
13:37:25.754262 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 701 win 2896 <nop,nop,timestamp 85495 85497>
13:37:25.764007 IP 10.10.0.2.47265 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 85498 85495>
13:37:25.764250 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 801 win 2896 <nop,nop,timestamp 85496 85498>
13:37:25.774057 IP 10.10.0.2.47265 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 85499 85496>
13:37:25.774333 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 901 win 2896 <nop,nop,timestamp 85497 85499>
13:37:25.783936 IP 10.10.0.2.47265 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 85500 85497>
13:37:25.784175 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1001 win 2896 <nop,nop,timestamp 85497 85500>
13:37:25.793831 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 85501 85497>
13:37:25.794211 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1101 win 2896 <nop,nop,timestamp 85499 85501>
13:37:25.803940 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 85502 85499>
13:37:25.804302 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1201 win 2896 <nop,nop,timestamp 85500 85502>
13:37:25.813885 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 85503 85500>
13:37:25.814205 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1301 win 2896 <nop,nop,timestamp 85501 85503>
13:37:25.823900 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 85504 85501>
13:37:25.824200 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1401 win 2896 <nop,nop,timestamp 85502 85504>
13:37:25.834082 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 85505 85502>
13:37:25.834402 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1501 win 2896 <nop,nop,timestamp 85503 85505>
13:37:25.843961 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 85506 85503>
13:37:25.844252 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1601 win 2896 <nop,nop,timestamp 85503 85506>
13:37:25.853984 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 85507 85503>
13:37:25.854306 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1701 win 2896 <nop,nop,timestamp 85505 85507>
13:37:25.863942 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 85508 85505>
13:37:25.864325 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1801 win 2896 <nop,nop,timestamp 85506 85508>
13:37:25.874050 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 85509 85506>
13:37:25.874466 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 1901 win 2896 <nop,nop,timestamp 85507 85509>
13:37:25.884355 IP 10.10.0.2.47265 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 85510 85507>
13:37:25.885145 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2001 win 2896 <nop,nop,timestamp 85508 85510>
13:37:25.894149 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 85511 85508>
13:37:25.894612 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2101 win 2896 <nop,nop,timestamp 85509 85511>
13:37:25.904001 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 85512 85509>
13:37:25.904191 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2201 win 2896 <nop,nop,timestamp 85509 85512>
13:37:25.913871 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 85513 85509>
13:37:25.914118 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2301 win 2896 <nop,nop,timestamp 85511 85513>
13:37:25.923909 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 85514 85511>
13:37:25.924219 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2401 win 2896 <nop,nop,timestamp 85512 85514>
13:37:25.933907 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 85515 85512>
13:37:25.934230 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2501 win 2896 <nop,nop,timestamp 85513 85515>
13:37:25.943868 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 85516 85513>
13:37:25.944120 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2601 win 2896 <nop,nop,timestamp 85514 85516>
13:37:25.953897 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 85517 85514>
13:37:25.954110 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2701 win 2896 <nop,nop,timestamp 85515 85517>
13:37:25.963946 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 85518 85515>
13:37:25.964221 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2801 win 2896 <nop,nop,timestamp 85516 85518>
13:37:25.973951 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 85519 85516>
13:37:25.974215 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 2901 win 2896 <nop,nop,timestamp 85517 85519>
13:37:25.983916 IP 10.10.0.2.47265 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 85520 85517>
13:37:25.984154 IP 10.40.0.2.9 > 10.10.0.2.47265: . ack 3001 win 2896 <nop,nop,timestamp 85518 85520>
13:37:25.994286 IP 10.10.0.2.47265 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 85521 85518>
13:37:25.996625 IP 10.40.0.2.9 > 10.10.0.2.47265: F 1:1(0) ack 3002 win 2896 <nop,nop,timestamp 85519 85521>
13:37:25.996804 IP 10.10.0.2.47265 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 85521 85519>
\end{lstlisting}

\section{Аггрессивная буферизация}

Буферизация (TCP CORK) работает частично, успевает накопиться часть данных

\begin{lstlisting}
c1:~# ./nagle cork 10.40.0.2 9 -1 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:47:22.248924 IP 10.10.0.2.36792 > 10.40.0.2.9: S 2338522188:2338522188(0) win 5840 <mss 1460,sackOK,timestamp 145144 0,nop,wscale 1>
13:47:22.269991 IP 10.40.0.2.9 > 10.10.0.2.36792: S 2341059938:2341059938(0) ack 2338522189 win 5792 <mss 1460,sackOK,timestamp 145145 145144,nop,wscale 1>
13:47:22.270349 IP 10.10.0.2.36792 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 145148 145145>
13:47:22.271541 IP 10.10.0.2.36792 > 10.40.0.2.9: . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 145148 145145>
13:47:22.271853 IP 10.40.0.2.9 > 10.10.0.2.36792: . ack 1449 win 4344 <nop,nop,timestamp 145145 145148>
13:47:22.272245 IP 10.10.0.2.36792 > 10.40.0.2.9: . 1449:2897(1448) ack 1 win 2920 <nop,nop,timestamp 145148 145145>
13:47:22.272475 IP 10.40.0.2.9 > 10.10.0.2.36792: . ack 2897 win 5792 <nop,nop,timestamp 145145 145148>
13:47:22.273051 IP 10.10.0.2.36792 > 10.40.0.2.9: FP 2897:3001(104) ack 1 win 2920 <nop,nop,timestamp 145148 145145>
13:47:22.284095 IP 10.40.0.2.9 > 10.10.0.2.36792: F 1:1(0) ack 3002 win 5792 <nop,nop,timestamp 145145 145148>
13:47:22.284333 IP 10.10.0.2.36792 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 145150 145145>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./nagle cork 10.40.0.2 9 0 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:50:33.380525 IP 10.10.0.2.48239 > 10.40.0.2.9: S 1052738207:1052738207(0) win 5840 <mss 1460,sackOK,timestamp 164257 0,nop,wscale 1>
13:50:33.380952 IP 10.40.0.2.9 > 10.10.0.2.48239: S 1037893116:1037893116(0) ack 1052738208 win 5792 <mss 1460,sackOK,timestamp 164257 164257,nop,wscale 1>
13:50:33.381284 IP 10.10.0.2.48239 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 164260 164257>
13:50:33.444670 IP 10.10.0.2.48239 > 10.40.0.2.9: . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 164267 164257>
13:50:33.445157 IP 10.40.0.2.9 > 10.10.0.2.48239: . ack 1449 win 4344 <nop,nop,timestamp 164264 164267>
13:50:33.484642 IP 10.10.0.2.48239 > 10.40.0.2.9: . 1449:2897(1448) ack 1 win 2920 <nop,nop,timestamp 164271 164264>
13:50:33.485121 IP 10.40.0.2.9 > 10.10.0.2.48239: . ack 2897 win 5792 <nop,nop,timestamp 164269 164271>
13:50:33.496053 IP 10.10.0.2.48239 > 10.40.0.2.9: FP 2897:3001(104) ack 1 win 2920 <nop,nop,timestamp 164272 164269>
13:50:33.501051 IP 10.40.0.2.9 > 10.10.0.2.48239: F 1:1(0) ack 3002 win 5792 <nop,nop,timestamp 164270 164272>
13:50:33.501383 IP 10.10.0.2.48239 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 164272 164270>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./nagle cork 10.40.0.2 9 40 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:03:02.500375 IP 10.10.0.2.57452 > 10.40.0.2.9: S 1912566756:1912566756(0) win 5840 <mss 1460,sackOK,timestamp 113776 0,nop,wscale 1>
19:03:02.500731 IP 10.40.0.2.9 > 10.10.0.2.57452: S 1910736489:1910736489(0) ack 1912566757 win 5792 <mss 1460,sackOK,timestamp 113777 113776,nop,wscale 1>
19:03:02.501008 IP 10.10.0.2.57452 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 113776 113777>
19:03:02.688695 IP 10.10.0.2.57452 > 10.40.0.2.9: P 1:401(400) ack 1 win 2920 <nop,nop,timestamp 113798 113777>
19:03:02.689302 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 401 win 3432 <nop,nop,timestamp 113796 113798>
19:03:02.908850 IP 10.10.0.2.57452 > 10.40.0.2.9: P 401:901(500) ack 1 win 2920 <nop,nop,timestamp 113821 113796>
19:03:02.909543 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 901 win 3968 <nop,nop,timestamp 113818 113821>
19:03:03.159161 IP 10.10.0.2.57452 > 10.40.0.2.9: P 901:1401(500) ack 1 win 2920 <nop,nop,timestamp 113846 113818>
19:03:03.159677 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 1401 win 4504 <nop,nop,timestamp 113842 113846>
19:03:03.409188 IP 10.10.0.2.57452 > 10.40.0.2.9: P 1401:1901(500) ack 1 win 2920 <nop,nop,timestamp 113871 113842>
19:03:03.409685 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 1901 win 5040 <nop,nop,timestamp 113867 113871>
19:03:03.659158 IP 10.10.0.2.57452 > 10.40.0.2.9: P 1901:2401(500) ack 1 win 2920 <nop,nop,timestamp 113896 113867>
19:03:03.659662 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 2401 win 5576 <nop,nop,timestamp 113892 113896>
19:03:03.909187 IP 10.10.0.2.57452 > 10.40.0.2.9: P 2401:2901(500) ack 1 win 2920 <nop,nop,timestamp 113921 113892>
19:03:03.909856 IP 10.40.0.2.9 > 10.10.0.2.57452: . ack 2901 win 6112 <nop,nop,timestamp 113917 113921>
19:03:03.999252 IP 10.10.0.2.57452 > 10.40.0.2.9: FP 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 113929 113917>
19:03:04.003934 IP 10.40.0.2.9 > 10.10.0.2.57452: F 1:1(0) ack 3002 win 6112 <nop,nop,timestamp 113926 113929>
19:03:04.004224 IP 10.10.0.2.57452 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 113929 113926>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./nagle cork 10.40.0.2 9 300 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:52:25.797063 IP 10.10.0.2.48241 > 10.40.0.2.9: S 2808269030:2808269030(0) win 5840 <mss 1460,sackOK,timestamp 175499 0,nop,wscale 1>
13:52:25.797452 IP 10.40.0.2.9 > 10.10.0.2.48241: S 2799439717:2799439717(0) ack 2808269031 win 5792 <mss 1460,sackOK,timestamp 175500 175499,nop,wscale 1>
13:52:25.797802 IP 10.10.0.2.48241 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 175499 175500>
13:52:25.994076 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 175521 175500>
13:52:25.994542 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 101 win 2896 <nop,nop,timestamp 175520 175521>
13:52:26.314246 IP 10.10.0.2.48241 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 175554 175520>
13:52:26.314807 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 201 win 2896 <nop,nop,timestamp 175552 175554>
13:52:26.634264 IP 10.10.0.2.48241 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 175586 175552>
13:52:26.634856 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 301 win 2896 <nop,nop,timestamp 175583 175586>
13:52:26.934180 IP 10.10.0.2.48241 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 175616 175583>
13:52:26.934770 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 401 win 2896 <nop,nop,timestamp 175614 175616>
13:52:27.254288 IP 10.10.0.2.48241 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 175648 175614>
13:52:27.254952 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 501 win 2896 <nop,nop,timestamp 175646 175648>
13:52:27.554198 IP 10.10.0.2.48241 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 175678 175646>
13:52:27.554798 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 601 win 2896 <nop,nop,timestamp 175676 175678>
13:52:27.864111 IP 10.10.0.2.48241 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 175708 175676>
13:52:27.864666 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 701 win 2896 <nop,nop,timestamp 175707 175708>
13:52:28.174023 IP 10.10.0.2.48241 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 175739 175707>
13:52:28.174565 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 801 win 2896 <nop,nop,timestamp 175738 175739>
13:52:28.484064 IP 10.10.0.2.48241 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 175771 175738>
13:52:28.484599 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 901 win 2896 <nop,nop,timestamp 175769 175771>
13:52:28.794237 IP 10.10.0.2.48241 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 175802 175769>
13:52:28.794787 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1001 win 2896 <nop,nop,timestamp 175799 175802>
13:52:29.114268 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 175834 175799>
13:52:29.114837 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1101 win 2896 <nop,nop,timestamp 175832 175834>
13:52:29.414262 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 175864 175832>
13:52:29.414750 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1201 win 2896 <nop,nop,timestamp 175861 175864>
13:52:29.714136 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 175894 175861>
13:52:29.714592 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1301 win 2896 <nop,nop,timestamp 175892 175894>
13:52:30.034197 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 175926 175892>
13:52:30.034711 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1401 win 2896 <nop,nop,timestamp 175923 175926>
13:52:30.354144 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 175958 175923>
13:52:30.354575 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1501 win 2896 <nop,nop,timestamp 175955 175958>
13:52:30.654263 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 175988 175955>
13:52:30.654741 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1601 win 2896 <nop,nop,timestamp 175985 175988>
13:52:30.974201 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 176020 175985>
13:52:30.974638 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1701 win 2896 <nop,nop,timestamp 176018 176020>
13:52:31.274193 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 176050 176018>
13:52:31.274781 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1801 win 2896 <nop,nop,timestamp 176047 176050>
13:52:31.593983 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 176081 176047>
13:52:31.594491 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 1901 win 2896 <nop,nop,timestamp 176079 176081>
13:52:31.894009 IP 10.10.0.2.48241 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 176111 176079>
13:52:31.894523 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2001 win 2896 <nop,nop,timestamp 176109 176111>
13:52:32.194017 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 176142 176109>
13:52:32.194508 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2101 win 2896 <nop,nop,timestamp 176140 176142>
13:52:32.514093 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 176173 176140>
13:52:32.514666 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2201 win 2896 <nop,nop,timestamp 176172 176173>
13:52:32.824202 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 176205 176172>
13:52:32.824748 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2301 win 2896 <nop,nop,timestamp 176203 176205>
13:52:33.134251 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 176236 176203>
13:52:33.134830 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2401 win 2896 <nop,nop,timestamp 176234 176236>
13:52:33.454260 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 176268 176234>
13:52:33.454813 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2501 win 2896 <nop,nop,timestamp 176266 176268>
13:52:33.754236 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 176298 176266>
13:52:33.754786 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2601 win 2896 <nop,nop,timestamp 176295 176298>
13:52:34.074075 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 176329 176295>
13:52:34.074564 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2701 win 2896 <nop,nop,timestamp 176328 176329>
13:52:34.374234 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 176360 176328>
13:52:34.374745 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2801 win 2896 <nop,nop,timestamp 176358 176360>
13:52:34.694275 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 176392 176358>
13:52:34.694914 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 2901 win 2896 <nop,nop,timestamp 176390 176392>
13:52:34.984162 IP 10.10.0.2.48241 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 176421 176390>
13:52:34.984819 IP 10.40.0.2.9 > 10.10.0.2.48241: . ack 3001 win 2896 <nop,nop,timestamp 176419 176421>
13:52:35.095694 IP 10.10.0.2.48241 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 176432 176419>
13:52:35.099606 IP 10.40.0.2.9 > 10.10.0.2.48241: F 1:1(0) ack 3002 win 2896 <nop,nop,timestamp 176430 176432>
13:52:35.099922 IP 10.10.0.2.48241 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 176432 176430>
\end{lstlisting}

\section{Отправка без задержки}

Увидим, что nodelay не помогает, когда окно отправителя полное.

\begin{lstlisting}
c1:~# ./nagle nodelay 10.40.0.2 9 -1 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:04:37.457808 IP 10.10.0.2.35030 > 10.40.0.2.9: S 3402447987:3402447987(0) win 5840 <mss 1460,sackOK,timestamp 123273 0,nop,wscale 1>
19:04:37.458043 IP 10.40.0.2.9 > 10.10.0.2.35030: S 3402087952:3402087952(0) ack 3402447988 win 5792 <mss 1460,sackOK,timestamp 123272 123273,nop,wscale 1>
19:04:37.458206 IP 10.10.0.2.35030 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458553 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458577 IP 10.10.0.2.35030 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458595 IP 10.10.0.2.35030 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458741 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 101 win 2896 <nop,nop,timestamp 123272 123273>
19:04:37.458750 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 201 win 2896 <nop,nop,timestamp 123272 123273>
19:04:37.458756 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 301 win 2896 <nop,nop,timestamp 123272 123273>
19:04:37.458873 IP 10.10.0.2.35030 > 10.40.0.2.9: P 301:1201(900) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458894 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458907 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458957 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 1201 win 3796 <nop,nop,timestamp 123272 123273>
19:04:37.458963 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 1301 win 3796 <nop,nop,timestamp 123272 123273>
19:04:37.458978 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.458987 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 1401 win 3796 <nop,nop,timestamp 123272 123273>
19:04:37.459000 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459060 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459087 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459111 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459155 IP 10.10.0.2.35030 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459175 IP 10.10.0.2.35030 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459189 IP 10.10.0.2.35030 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.459510 IP 10.10.0.2.35030 > 10.40.0.2.9: FP 2201:3001(800) ack 1 win 2920 <nop,nop,timestamp 123273 123272>
19:04:37.460058 IP 10.40.0.2.9 > 10.10.0.2.35030: . ack 3002 win 4696 <nop,nop,timestamp 123272 123273>
19:04:37.463737 IP 10.40.0.2.9 > 10.10.0.2.35030: F 1:1(0) ack 3002 win 4696 <nop,nop,timestamp 123272 123273>
19:04:37.463818 IP 10.10.0.2.35030 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 123273 123272>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./nagle nodelay 10.40.0.2 9 0 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:59:42.862519 IP 10.10.0.2.48850 > 10.40.0.2.9: S 1081633369:1081633369(0) win 5840 <mss 1460,sackOK,timestamp 219205 0,nop,wscale 1>
13:59:42.862940 IP 10.40.0.2.9 > 10.10.0.2.48850: S 1082165707:1082165707(0) ack 1081633370 win 5792 <mss 1460,sackOK,timestamp 219206 219205,nop,wscale 1>
13:59:42.863250 IP 10.10.0.2.48850 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 219208 219206>
13:59:42.863817 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 219208 219206>
13:59:42.864134 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 101 win 2896 <nop,nop,timestamp 219206 219208>
13:59:42.865782 IP 10.10.0.2.48850 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 219209 219206>
13:59:42.865842 IP 10.10.0.2.48850 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 219209 219206>
13:59:42.865990 IP 10.10.0.2.48850 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 219209 219206>
13:59:42.866147 IP 10.10.0.2.48850 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 219209 219206>
13:59:42.867499 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 201 win 2896 <nop,nop,timestamp 219206 219209>
13:59:42.867539 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 301 win 2896 <nop,nop,timestamp 219206 219209>
13:59:42.867555 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 401 win 2896 <nop,nop,timestamp 219206 219209>
13:59:42.867565 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 501 win 2896 <nop,nop,timestamp 219206 219209>
13:59:42.874736 IP 10.10.0.2.48850 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 219210 219206>
13:59:42.874801 IP 10.10.0.2.48850 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 219210 219206>
13:59:42.874891 IP 10.10.0.2.48850 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 219210 219206>
13:59:42.875018 IP 10.10.0.2.48850 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 219210 219206>
13:59:42.875875 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 901 win 2896 <nop,nop,timestamp 219206 219210>
13:59:42.885486 IP 10.10.0.2.48850 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 219211 219206>
13:59:42.885553 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 219211 219206>
13:59:42.885905 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1101 win 2896 <nop,nop,timestamp 219209 219211>
13:59:42.895180 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.895496 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.895703 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1201 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.895734 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.895845 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.895918 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1301 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.896132 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1501 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.896315 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.896476 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.896535 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.896622 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1601 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.896671 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.896725 IP 10.10.0.2.48850 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 219212 219209>
13:59:42.896800 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 1801 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.896980 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2001 win 2896 <nop,nop,timestamp 219209 219212>
13:59:42.906421 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.906597 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.906800 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2101 win 2896 <nop,nop,timestamp 219209 219213>
13:59:42.906858 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.907027 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2201 win 2896 <nop,nop,timestamp 219209 219213>
13:59:42.907162 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.907199 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2301 win 2896 <nop,nop,timestamp 219209 219213>
13:59:42.907578 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.907621 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2401 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.907663 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.907880 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 219213 219209>
13:59:42.907976 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2601 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.908035 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 219213 219211>
13:59:42.908178 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2701 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.908272 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 219213 219211>
13:59:42.908298 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2801 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.908534 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 2901 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.913834 IP 10.10.0.2.48850 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 219213 219211>
13:59:42.914203 IP 10.40.0.2.9 > 10.10.0.2.48850: . ack 3001 win 2896 <nop,nop,timestamp 219211 219213>
13:59:42.925253 IP 10.10.0.2.48850 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 219214 219211>
13:59:42.929057 IP 10.40.0.2.9 > 10.10.0.2.48850: F 1:1(0) ack 3002 win 2896 <nop,nop,timestamp 219212 219214>
13:59:42.929313 IP 10.10.0.2.48850 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 219214 219212>
\end{lstlisting}

*********************************************************

\begin{lstlisting}
c1:~# ./nagle nodelay 10.40.0.2 9 10 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
14:00:35.730179 IP 10.10.0.2.48851 > 10.40.0.2.9: S 1897835650:1897835650(0) win 5840 <mss 1460,sackOK,timestamp 224492 0,nop,wscale 1>
14:00:35.730478 IP 10.40.0.2.9 > 10.10.0.2.48851: S 1904152280:1904152280(0) ack 1897835651 win 5792 <mss 1460,sackOK,timestamp 224492 224492,nop,wscale 1>
14:00:35.730701 IP 10.10.0.2.48851 > 10.40.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 224495 224492>
14:00:35.731105 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 224495 224492>
14:00:35.731326 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 101 win 2896 <nop,nop,timestamp 224492 224495>
14:00:35.743890 IP 10.10.0.2.48851 > 10.40.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 224496 224492>
14:00:35.744213 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 201 win 2896 <nop,nop,timestamp 224492 224496>
14:00:35.754785 IP 10.10.0.2.48851 > 10.40.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 224498 224492>
14:00:35.755260 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 301 win 2896 <nop,nop,timestamp 224496 224498>
14:00:35.774331 IP 10.10.0.2.48851 > 10.40.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 224500 224496>
14:00:35.774948 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 401 win 2896 <nop,nop,timestamp 224498 224500>
14:00:35.785302 IP 10.10.0.2.48851 > 10.40.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 224501 224498>
14:00:35.785764 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 501 win 2896 <nop,nop,timestamp 224499 224501>
14:00:35.804167 IP 10.10.0.2.48851 > 10.40.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 224502 224499>
14:00:35.804722 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 601 win 2896 <nop,nop,timestamp 224500 224502>
14:00:35.815366 IP 10.10.0.2.48851 > 10.40.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 224504 224500>
14:00:35.815894 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 701 win 2896 <nop,nop,timestamp 224502 224504>
14:00:35.834369 IP 10.10.0.2.48851 > 10.40.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 224506 224502>
14:00:35.835031 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 801 win 2896 <nop,nop,timestamp 224504 224506>
14:00:35.845677 IP 10.10.0.2.48851 > 10.40.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 224507 224504>
14:00:35.846230 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 901 win 2896 <nop,nop,timestamp 224505 224507>
14:00:35.864237 IP 10.10.0.2.48851 > 10.40.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 224508 224505>
14:00:35.864813 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1001 win 2896 <nop,nop,timestamp 224506 224508>
14:00:35.875340 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 224510 224506>
14:00:35.875845 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1101 win 2896 <nop,nop,timestamp 224508 224510>
14:00:35.894203 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 224511 224508>
14:00:35.894791 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1201 win 2896 <nop,nop,timestamp 224509 224511>
14:00:35.905437 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 224513 224509>
14:00:35.905944 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1301 win 2896 <nop,nop,timestamp 224511 224513>
14:00:35.924265 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 224514 224511>
14:00:35.924835 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1401 win 2896 <nop,nop,timestamp 224512 224514>
14:00:35.935566 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 224516 224512>
14:00:35.936144 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1501 win 2896 <nop,nop,timestamp 224514 224516>
14:00:35.954418 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 224518 224514>
14:00:35.954983 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1601 win 2896 <nop,nop,timestamp 224516 224518>
14:00:35.965401 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 224519 224516>
14:00:35.965906 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1701 win 2896 <nop,nop,timestamp 224517 224519>
14:00:35.984259 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 224520 224517>
14:00:35.984843 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1801 win 2896 <nop,nop,timestamp 224519 224520>
14:00:35.995552 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 224522 224519>
14:00:35.996123 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 1901 win 2896 <nop,nop,timestamp 224520 224522>
14:00:36.014262 IP 10.10.0.2.48851 > 10.40.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 224523 224520>
14:00:36.014864 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2001 win 2896 <nop,nop,timestamp 224521 224523>
14:00:36.025562 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 224525 224521>
14:00:36.026095 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2101 win 2896 <nop,nop,timestamp 224523 224525>
14:00:36.044191 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 224526 224523>
14:00:36.044597 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2201 win 2896 <nop,nop,timestamp 224525 224526>
14:00:36.055317 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 224528 224525>
14:00:36.055837 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2301 win 2896 <nop,nop,timestamp 224526 224528>
14:00:36.074236 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 224529 224526>
14:00:36.074726 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2401 win 2896 <nop,nop,timestamp 224527 224529>
14:00:36.085367 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 224531 224527>
14:00:36.085782 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2501 win 2896 <nop,nop,timestamp 224529 224531>
14:00:36.104171 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 224532 224529>
14:00:36.104634 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2601 win 2896 <nop,nop,timestamp 224530 224532>
14:00:36.115230 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 224534 224530>
14:00:36.115609 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2701 win 2896 <nop,nop,timestamp 224532 224534>
14:00:36.134060 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 224535 224532>
14:00:36.134525 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2801 win 2896 <nop,nop,timestamp 224533 224535>
14:00:36.145538 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 224537 224533>
14:00:36.145943 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 2901 win 2896 <nop,nop,timestamp 224535 224537>
14:00:36.164058 IP 10.10.0.2.48851 > 10.40.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 224538 224535>
14:00:36.164423 IP 10.40.0.2.9 > 10.10.0.2.48851: . ack 3001 win 2896 <nop,nop,timestamp 224537 224538>
14:00:36.176301 IP 10.10.0.2.48851 > 10.40.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 224540 224537>
14:00:36.180834 IP 10.40.0.2.9 > 10.10.0.2.48851: F 1:1(0) ack 3002 win 2896 <nop,nop,timestamp 224538 224540>
14:00:36.181122 IP 10.10.0.2.48851 > 10.40.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 224540 224538>
\end{lstlisting}

\section{Быстрый повтор}

Отправка пакет из с1 в с4, при установки имитации потери 11-го пакета в с3
\begin{lstlisting}
c3:~# /etc/drop 11
I will drop every 11 packet (counting from 1).
\end{lstlisting}

Результат быстрого повтора
\begin{lstlisting}
c1:~# ./nagle nodelay 10.30.0.2 9 1 30

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:13:09.874356 IP 10.10.0.2.56228 > 10.30.0.2.9: S 2847527172:2847527172(0) win 5840 <mss 1460,sackOK,timestamp 174514 0,nop,wscale 1>
19:13:12.848674 IP 10.10.0.2.56228 > 10.30.0.2.9: S 2847527172:2847527172(0) win 5840 <mss 1460,sackOK,timestamp 174814 0,nop,wscale 1>
19:13:12.849630 IP 10.30.0.2.9 > 10.10.0.2.56228: S 2893254512:2893254512(0) ack 2847527173 win 2096 <mss 536,sackOK,timestamp 174798 174814,nop,wscale 1>
19:13:12.849813 IP 10.10.0.2.56228 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 174814 174798>
19:13:12.849944 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 174814 174798>
19:13:12.850154 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 101 win 1048 <nop,nop,timestamp 174798 174814>
19:13:12.860392 IP 10.10.0.2.56228 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 174816 174798>
19:13:12.860945 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 201 win 1048 <nop,nop,timestamp 174798 174816>
19:13:12.869390 IP 10.10.0.2.56228 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 174817 174798>
19:13:12.870272 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 301 win 1048 <nop,nop,timestamp 174800 174817>
19:13:12.880225 IP 10.10.0.2.56228 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 174818 174800>
19:13:12.889341 IP 10.10.0.2.56228 > 10.30.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 174819 174800>
19:13:12.890352 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 501 win 1048 <nop,nop,timestamp 174802 174819>
19:13:12.900693 IP 10.10.0.2.56228 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 174820 174802>
19:13:12.901700 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 601 win 1048 <nop,nop,timestamp 174803 174820>
19:13:12.909203 IP 10.10.0.2.56228 > 10.30.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 174821 174803>
19:13:12.910118 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 701 win 1048 <nop,nop,timestamp 174804 174821>
19:13:12.920325 IP 10.10.0.2.56228 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 174822 174804>
19:13:12.921319 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 801 win 1048 <nop,nop,timestamp 174805 174822>
19:13:12.930010 IP 10.10.0.2.56228 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 174823 174805>
19:13:12.930871 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174806 174823>
19:13:12.940260 IP 10.10.0.2.56228 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 174824 174806>
19:13:12.949365 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 174825 174806>
19:13:12.950417 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174808 174823,nop,nop,sack 1 {1001:1101}>
19:13:12.960450 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 174826 174808>
19:13:12.961355 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174809 174823,nop,nop,sack 1 {1001:1201}>
19:13:12.969218 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 174827 174809>
19:13:12.970088 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174810 174823,nop,nop,sack 1 {1001:1301}>
19:13:12.970456 IP 10.10.0.2.56228 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 174827 174810>
19:13:12.971231 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1301 win 1048 <nop,nop,timestamp 174810 174827>
19:13:12.981165 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 174828 174810>
19:13:12.982146 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174811 174828>
19:13:12.988709 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 174828 174811>
19:13:12.998829 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 174829 174811>
19:13:12.999629 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174813 174828,nop,nop,sack 1 {1501:1601}>
19:13:13.010216 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 174831 174813>
19:13:13.010952 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174814 174828,nop,nop,sack 1 {1501:1701}>
19:13:13.020083 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 174832 174814>
19:13:13.020841 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174815 174828,nop,nop,sack 1 {1501:1801}>
19:13:13.021179 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 174832 174815>
19:13:13.021832 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1801 win 1048 <nop,nop,timestamp 174815 174832>
19:13:13.031145 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 174833 174815>
19:13:13.032054 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174816 174833>
19:13:13.038805 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 174833 174816>
19:13:13.048729 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 174834 174816>
19:13:13.049569 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174818 174833,nop,nop,sack 1 {2001:2101}>
19:13:13.060240 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 174836 174818>
19:13:13.061296 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174819 174833,nop,nop,sack 1 {2001:2201}>
19:13:13.070195 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 174837 174819>
19:13:13.071168 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174820 174833,nop,nop,sack 1 {2001:2301}>
19:13:13.071603 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 174837 174820>
19:13:13.072401 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2301 win 1048 <nop,nop,timestamp 174820 174837>
19:13:13.080960 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 174838 174820>
19:13:13.081882 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174821 174838>
19:13:13.088845 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 174838 174821>
19:13:13.098726 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 174839 174821>
19:13:13.099916 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174823 174838,nop,nop,sack 1 {2501:2601}>
19:13:13.110536 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 174841 174823>
19:13:13.111456 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174824 174838,nop,nop,sack 1 {2501:2701}>
19:13:13.119241 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 174842 174824>
19:13:13.120125 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174824 174838,nop,nop,sack 1 {2501:2801}>
19:13:13.120436 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 174842 174824>
19:13:13.121142 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2801 win 1048 <nop,nop,timestamp 174824 174842>
19:13:13.131258 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 174843 174824>
19:13:13.132289 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2901 win 1048 <nop,nop,timestamp 174826 174843>
19:13:13.138815 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 174843 174826>
19:13:13.149795 IP 10.10.0.2.56228 > 10.30.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 174844 174826>
19:13:13.150671 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2901 win 1048 <nop,nop,timestamp 174828 174843,nop,nop,sack 1 {3001:3002}>
19:13:13.348625 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 174864 174828>
19:13:13.349979 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 3002 win 1048 <nop,nop,timestamp 174848 174864>
19:13:13.353426 IP 10.30.0.2.9 > 10.10.0.2.56228: F 1:1(0) ack 3002 win 1048 <nop,nop,timestamp 174848 174864>
19:13:13.353770 IP 10.10.0.2.56228 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 174864 174848>

*********************************************************

c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:13:09.869377 IP 10.10.0.2.56228 > 10.30.0.2.9: S 2847527172:2847527172(0) win 5840 <mss 1460,sackOK,timestamp 174514 0,nop,wscale 1>
19:13:12.843787 IP 10.10.0.2.56228 > 10.30.0.2.9: S 2847527172:2847527172(0) win 5840 <mss 1460,sackOK,timestamp 174814 0,nop,wscale 1>
19:13:12.844296 IP 10.30.0.2.9 > 10.10.0.2.56228: S 2893254512:2893254512(0) ack 2847527173 win 2096 <mss 536,sackOK,timestamp 174798 174814,nop,wscale 1>
19:13:12.844731 IP 10.10.0.2.56228 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 174814 174798>
19:13:12.844852 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 174814 174798>
19:13:12.844970 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 101 win 1048 <nop,nop,timestamp 174798 174814>
19:13:12.855415 IP 10.10.0.2.56228 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 174816 174798>
19:13:12.855706 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 201 win 1048 <nop,nop,timestamp 174798 174816>
19:13:12.864466 IP 10.10.0.2.56228 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 174817 174798>
19:13:12.864936 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 301 win 1048 <nop,nop,timestamp 174800 174817>
19:13:12.875326 IP 10.10.0.2.56228 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 174818 174800>
19:13:12.884507 IP 10.10.0.2.56228 > 10.30.0.2.9: P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 174819 174800>
19:13:12.884935 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 501 win 1048 <nop,nop,timestamp 174802 174819>
19:13:12.895841 IP 10.10.0.2.56228 > 10.30.0.2.9: P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 174820 174802>
19:13:12.896312 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 601 win 1048 <nop,nop,timestamp 174803 174820>
19:13:12.904300 IP 10.10.0.2.56228 > 10.30.0.2.9: P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 174821 174803>
19:13:12.904748 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 701 win 1048 <nop,nop,timestamp 174804 174821>
19:13:12.915457 IP 10.10.0.2.56228 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 174822 174804>
19:13:12.915938 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 801 win 1048 <nop,nop,timestamp 174805 174822>
19:13:12.925128 IP 10.10.0.2.56228 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 174823 174805>
19:13:12.925566 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174806 174823>
19:13:12.935416 IP 10.10.0.2.56228 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 174824 174806>
19:13:12.944541 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 174825 174806>
19:13:12.945015 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174808 174823,nop,nop,sack 1 {1001:1101}>
19:13:12.955540 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 174826 174808>
19:13:12.956009 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174809 174823,nop,nop,sack 1 {1001:1201}>
19:13:12.964309 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 174827 174809>
19:13:12.964714 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 901 win 1048 <nop,nop,timestamp 174810 174823,nop,nop,sack 1 {1001:1301}>
19:13:12.965489 IP 10.10.0.2.56228 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 174827 174810>
19:13:12.965851 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1301 win 1048 <nop,nop,timestamp 174810 174827>
19:13:12.976289 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 174828 174810>
19:13:12.976757 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174811 174828>
19:13:12.983711 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 174828 174811>
19:13:12.993913 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 174829 174811>
19:13:12.994305 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174813 174828,nop,nop,sack 1 {1501:1601}>
19:13:13.005271 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 174831 174813>
19:13:13.005633 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174814 174828,nop,nop,sack 1 {1501:1701}>
19:13:13.015137 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 174832 174814>
19:13:13.015566 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1401 win 1048 <nop,nop,timestamp 174815 174828,nop,nop,sack 1 {1501:1801}>
19:13:13.016155 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 174832 174815>
19:13:13.016506 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1801 win 1048 <nop,nop,timestamp 174815 174832>
19:13:13.026268 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 174833 174815>
19:13:13.026708 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174816 174833>
19:13:13.033887 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 174833 174816>
19:13:13.043791 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 174834 174816>
19:13:13.044226 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174818 174833,nop,nop,sack 1 {2001:2101}>
19:13:13.055375 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 174836 174818>
19:13:13.055908 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174819 174833,nop,nop,sack 1 {2001:2201}>
19:13:13.065304 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 174837 174819>
19:13:13.065799 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 1901 win 1048 <nop,nop,timestamp 174820 174833,nop,nop,sack 1 {2001:2301}>
19:13:13.066712 IP 10.10.0.2.56228 > 10.30.0.2.9: P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 174837 174820>
19:13:13.067096 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2301 win 1048 <nop,nop,timestamp 174820 174837>
19:13:13.075986 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 174838 174820>
19:13:13.076491 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174821 174838>
19:13:13.084007 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 174838 174821>
19:13:13.093836 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 174839 174821>
19:13:13.094524 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174823 174838,nop,nop,sack 1 {2501:2601}>
19:13:13.105655 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 174841 174823>
19:13:13.106065 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174824 174838,nop,nop,sack 1 {2501:2701}>
19:13:13.114326 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 174842 174824>
19:13:13.114799 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2401 win 1048 <nop,nop,timestamp 174824 174838,nop,nop,sack 1 {2501:2801}>
19:13:13.115431 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 174842 174824>
19:13:13.115837 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2801 win 1048 <nop,nop,timestamp 174824 174842>
19:13:13.126359 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 174843 174824>
19:13:13.126900 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2901 win 1048 <nop,nop,timestamp 174826 174843>
19:13:13.133914 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 174843 174826>
19:13:13.144886 IP 10.10.0.2.56228 > 10.30.0.2.9: F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 174844 174826>
19:13:13.145337 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 2901 win 1048 <nop,nop,timestamp 174828 174843,nop,nop,sack 1 {3001:3002}>
19:13:13.343740 IP 10.10.0.2.56228 > 10.30.0.2.9: P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 174864 174828>
19:13:13.344599 IP 10.30.0.2.9 > 10.10.0.2.56228: . ack 3002 win 1048 <nop,nop,timestamp 174848 174864>
19:13:13.348102 IP 10.30.0.2.9 > 10.10.0.2.56228: F 1:1(0) ack 3002 win 1048 <nop,nop,timestamp 174848 174864>
19:13:13.348780 IP 10.10.0.2.56228 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 174864 174848>
\end{lstlisting}

\section{Обычный повтор}

\begin{lstlisting}
c1:~# ./nagle default 10.30.0.2 9 1 30

c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:18:54.116934 IP 10.10.0.2.33677 > 10.30.0.2.9: S 3949898778:3949898778(0) win 5840 <mss 1460,sackOK,timestamp 208941 0,nop,wscale 1>
19:18:54.127213 IP 10.30.0.2.9 > 10.10.0.2.33677: S 3945908018:3945908018(0) ack 3949898779 win 2096 <mss 536,sackOK,timestamp 208925 208941,nop,wscale 1>
19:18:54.137235 IP 10.10.0.2.33677 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 208943 208925>
19:18:54.137824 IP 10.10.0.2.33677 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 208943 208925>
19:18:54.193923 IP 10.10.0.2.33677 > 10.30.0.2.9: . 101:625(524) ack 1 win 2920 <nop,nop,timestamp 208949 208925>
19:18:54.194435 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 625 win 1572 <nop,nop,timestamp 208933 208949>
19:18:54.195306 IP 10.10.0.2.33677 > 10.30.0.2.9: P 625:701(76) ack 1 win 2920 <nop,nop,timestamp 208949 208933>
19:18:54.195770 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 701 win 1572 <nop,nop,timestamp 208933 208949>
19:18:54.206757 IP 10.10.0.2.33677 > 10.30.0.2.9: P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 208951 208933>
19:18:54.207215 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 801 win 1572 <nop,nop,timestamp 208934 208951>
19:18:54.213904 IP 10.10.0.2.33677 > 10.30.0.2.9: P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 208951 208934>
19:18:54.214494 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 901 win 1572 <nop,nop,timestamp 208935 208951>
19:18:54.223804 IP 10.10.0.2.33677 > 10.30.0.2.9: P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 208952 208935>
19:18:54.224336 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 1001 win 1572 <nop,nop,timestamp 208936 208952>
19:18:54.233788 IP 10.10.0.2.33677 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 208953 208936>
19:18:54.294021 IP 10.10.0.2.33677 > 10.30.0.2.9: . 1101:1625(524) ack 1 win 2920 <nop,nop,timestamp 208960 208936>
19:18:54.294532 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 1001 win 1572 <nop,nop,timestamp 208943 208952,nop,nop,sack 1 {1101:1625}>
19:18:54.344492 IP 10.10.0.2.33677 > 10.30.0.2.9: . 1625:2149(524) ack 1 win 2920 <nop,nop,timestamp 208965 208943>
19:18:54.345043 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 1001 win 1572 <nop,nop,timestamp 208948 208952,nop,nop,sack 1 {1101:2149}>
19:18:54.394410 IP 10.10.0.2.33677 > 10.30.0.2.9: . 2149:2673(524) ack 1 win 2920 <nop,nop,timestamp 208970 208948>
19:18:54.394959 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 1001 win 1572 <nop,nop,timestamp 208953 208952,nop,nop,sack 1 {1101:2673}>
19:18:54.395985 IP 10.10.0.2.33677 > 10.30.0.2.9: P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 208970 208953>
19:18:54.396552 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 2673 win 1572 <nop,nop,timestamp 208953 208970>
19:18:54.397490 IP 10.10.0.2.33677 > 10.30.0.2.9: P 2673:2701(28) ack 1 win 2920 <nop,nop,timestamp 208970 208953>
19:18:54.398042 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 2701 win 1572 <nop,nop,timestamp 208953 208970>
19:18:54.408644 IP 10.10.0.2.33677 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 208971 208953>
19:18:54.435510 IP 10.10.0.2.33677 > 10.30.0.2.9: FP 2801:3001(200) ack 1 win 2920 <nop,nop,timestamp 208974 208953>
19:18:54.435952 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 2701 win 1572 <nop,nop,timestamp 208957 208970,nop,nop,sack 1 {2801:3002}>
19:18:54.623917 IP 10.10.0.2.33677 > 10.30.0.2.9: P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 208993 208957>
19:18:54.624490 IP 10.30.0.2.9 > 10.10.0.2.33677: . ack 3002 win 1572 <nop,nop,timestamp 208976 208993>
19:18:54.628198 IP 10.30.0.2.9 > 10.10.0.2.33677: F 1:1(0) ack 3002 win 1572 <nop,nop,timestamp 208976 208993>
19:18:54.628876 IP 10.10.0.2.33677 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 208993 208976>

******** drop 10 packets ********
c3:~# /etc/drop 10
I will drop every 10 packet (counting from 1).

c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:23:12.009510 IP 10.10.0.2.57770 > 10.30.0.2.9: S 3696296490:3696296490(0) win 5840 <mss 1460,sackOK,timestamp 234731 0,nop,wscale 1>
19:23:15.014072 IP 10.10.0.2.57770 > 10.30.0.2.9: S 3696296490:3696296490(0) win 5840 <mss 1460,sackOK,timestamp 235032 0,nop,wscale 1>
19:23:15.014645 IP 10.30.0.2.9 > 10.10.0.2.57770: S 3747254285:3747254285(0) ack 3696296491 win 2096 <mss 536,sackOK,timestamp 235015 235032,nop,wscale 1>
19:23:15.015684 IP 10.10.0.2.57770 > 10.30.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 235032 235015>
19:23:15.016295 IP 10.10.0.2.57770 > 10.30.0.2.9: P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 235032 235015>
19:23:15.016602 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 101 win 1048 <nop,nop,timestamp 235015 235032>
19:23:15.027075 IP 10.10.0.2.57770 > 10.30.0.2.9: P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 235033 235015>
19:23:15.027334 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 201 win 1048 <nop,nop,timestamp 235015 235033>
19:23:15.033856 IP 10.10.0.2.57770 > 10.30.0.2.9: P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 235033 235015>
19:23:15.034352 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 301 win 1048 <nop,nop,timestamp 235015 235033>
19:23:15.044709 IP 10.10.0.2.57770 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 235035 235015>
19:23:15.104420 IP 10.10.0.2.57770 > 10.30.0.2.9: . 401:925(524) ack 1 win 2920 <nop,nop,timestamp 235041 235015>
19:23:15.104942 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 301 win 1048 <nop,nop,timestamp 235024 235033,nop,nop,sack 1 {401:925}>
19:23:15.154128 IP 10.10.0.2.57770 > 10.30.0.2.9: . 925:1449(524) ack 1 win 2920 <nop,nop,timestamp 235046 235024>
19:23:15.154707 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 301 win 1048 <nop,nop,timestamp 235029 235033,nop,nop,sack 1 {401:1449}>
19:23:15.204218 IP 10.10.0.2.57770 > 10.30.0.2.9: . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 235051 235029>
19:23:15.204718 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 301 win 1048 <nop,nop,timestamp 235034 235033,nop,nop,sack 1 {401:1973}>
19:23:15.205650 IP 10.10.0.2.57770 > 10.30.0.2.9: P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 235051 235034>
19:23:15.206137 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 1973 win 1048 <nop,nop,timestamp 235034 235051>
19:23:15.206671 IP 10.10.0.2.57770 > 10.30.0.2.9: P 1973:2001(28) ack 1 win 2920 <nop,nop,timestamp 235051 235034>
19:23:15.423981 IP 10.10.0.2.57770 > 10.30.0.2.9: P 1973:2001(28) ack 1 win 2920 <nop,nop,timestamp 235073 235034>
19:23:15.424620 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 2001 win 1048 <nop,nop,timestamp 235056 235073,nop,nop,sack 1 {1973:2001}>
19:23:15.425549 IP 10.10.0.2.57770 > 10.30.0.2.9: . 2001:2525(524) ack 1 win 2920 <nop,nop,timestamp 235073 235056>
19:23:15.425597 IP 10.10.0.2.57770 > 10.30.0.2.9: FP 2525:3001(476) ack 1 win 2920 <nop,nop,timestamp 235073 235056>
19:23:15.426093 IP 10.30.0.2.9 > 10.10.0.2.57770: . ack 2525 win 1572 <nop,nop,timestamp 235056 235073>
19:23:15.430017 IP 10.30.0.2.9 > 10.10.0.2.57770: F 1:1(0) ack 3002 win 2096 <nop,nop,timestamp 235056 235073>
19:23:15.430678 IP 10.10.0.2.57770 > 10.30.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 235073 235056>
\end{lstlisting}

\section{Неудачная попытка соединени с портом}

Приведена попытка соединения с портом, который никто не слушает.
\begin{lstlisting}
c1:~# ./nagle default 10.50.0.2 12 1 30
connect: Connection refused

c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:27:44.719923 IP 10.10.0.2.42077 > 10.50.0.2.12: S 3684735623:3684735623(0) win 5840 <mss 1460,sackOK,timestamp 262001 0,nop,wscale 1>
19:27:44.730607 IP 10.50.0.2.12 > 10.10.0.2.42077: R 0:0(0) ack 3684735624 win 0

*********************************************************

c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:27:44.714853 IP 10.10.0.2.42077 > 10.50.0.2.12: S 3684735623:3684735623(0) win 5840 <mss 1460,sackOK,timestamp 262001 0,nop,wscale 1>
19:27:44.725389 IP 10.50.0.2.12 > 10.10.0.2.42077: R 0:0(0) ack 3684735624 win 0
\end{lstlisting}

\section{Опыт с PMTU}

Во-первых, нужно отключить коррекцию величины MSS на маршрутизаторах c3 и c4.
\begin{lstlisting}
c3:~# iptables -F
c4:~# iptables -F
c4:~# ip r show cache
local 10.50.0.1 from 10.50.0.2 dev lo  src 10.50.0.1 
    cache <local,src-direct>  iif eth1
local 10.30.0.2 from 10.30.0.1 dev lo  src 10.30.0.2 
    cache <local,src-direct>  iif eth0
10.10.0.2 via 10.30.0.1 dev eth0  src 10.30.0.2 
    cache  mtu 576 advmss 536 hoplimit 64
10.10.0.2 from 10.50.0.2 via 10.30.0.1 dev eth0  src 10.50.0.1 
    cache <src-direct>  mtu 576 advmss 536 hoplimit 64 iif eth1
10.50.0.2 from 10.10.0.2 dev eth1  src 10.30.0.2 
    cache  mtu 1500 advmss 1460 hoplimit 64 iif eth0
\end{lstlisting}

После этих подготовительных действий мы наверное увидим PMTU в действии при попытке соединится с c1 на c6.

\begin{lstlisting}
c1:~# ./a.out cork 10.50.0.2 9 1 30

c2:~# tcpdump -n -i eth0 tcp or icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:34:59.852557 IP 10.10.0.2.46650 > 10.50.0.2.9: S 1913568519:1913568519(0) win 5840 <mss 1460,sackOK,timestamp 305511 0,nop,wscale 1>
19:34:59.874218 IP 10.50.0.2.9 > 10.10.0.2.46650: S 1927030933:1927030933(0) ack 1913568520 win 5792 <mss 1460,sackOK,timestamp 305512 305511,nop,wscale 1>
19:34:59.874485 IP 10.10.0.2.46650 > 10.50.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 305516 305512>
19:35:00.009229 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 305531 305512>
19:35:00.009279 IP 10.10.0.1 > 10.10.0.2: ICMP 10.50.0.2 unreachable - need to frag (mtu 1492), length 556
19:35:00.009775 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1:1441(1440) ack 1 win 2920 <nop,nop,timestamp 305531 305512>
19:35:00.009823 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 305531 305512>
19:35:00.010340 IP 10.20.0.2 > 10.10.0.2: ICMP 10.50.0.2 unreachable - need to frag (mtu 576), length 556
19:35:00.011174 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1 win 2896 <nop,nop,timestamp 305527 305516,nop,nop,sack 1 {1441:1449}>
19:35:00.011537 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.011588 IP 10.10.0.2.46650 > 10.50.0.2.9: . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.012534 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 525 win 3432 <nop,nop,timestamp 305527 305531,nop,nop,sack 1 {1441:1449}>
19:35:00.012564 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1049 win 3956 <nop,nop,timestamp 305527 305531,nop,nop,sack 1 {1441:1449}>
19:35:00.012832 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1049:1441(392) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.014080 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1449 win 4480 <nop,nop,timestamp 305527 305531>
19:35:00.059407 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 305536 305527>
19:35:00.060971 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1973 win 5004 <nop,nop,timestamp 305532 305536>
19:35:00.109401 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1973:2497(524) ack 1 win 2920 <nop,nop,timestamp 305541 305532>
19:35:00.110950 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 2497 win 5528 <nop,nop,timestamp 305537 305541>
19:35:00.170311 IP 10.10.0.2.46650 > 10.50.0.2.9: FP 2497:3001(504) ack 1 win 2920 <nop,nop,timestamp 305547 305537>
19:35:00.175634 IP 10.50.0.2.9 > 10.10.0.2.46650: F 1:1(0) ack 3002 win 6052 <nop,nop,timestamp 305543 305547>
19:35:00.175966 IP 10.10.0.2.46650 > 10.50.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 305547 305543>

*********************************************************

c6:~# tcpdump -n -i eth0 tcp or icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
19:34:59.866098 IP 10.10.0.2.46650 > 10.50.0.2.9: S 1913568519:1913568519(0) win 5840 <mss 1460,sackOK,timestamp 305511 0,nop,wscale 1>
19:34:59.866155 IP 10.50.0.2.9 > 10.10.0.2.46650: S 1927030933:1927030933(0) ack 1913568520 win 5792 <mss 1460,sackOK,timestamp 305512 305511,nop,wscale 1>
19:34:59.878127 IP 10.10.0.2.46650 > 10.50.0.2.9: . ack 1 win 2920 <nop,nop,timestamp 305516 305512>
19:35:00.013635 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 305531 305512>
19:35:00.013717 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1 win 2896 <nop,nop,timestamp 305527 305516,nop,nop,sack 1 {1441:1449}>
19:35:00.015128 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.015144 IP 10.10.0.2.46650 > 10.50.0.2.9: . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.015200 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 525 win 3432 <nop,nop,timestamp 305527 305531,nop,nop,sack 1 {1441:1449}>
19:35:00.015231 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1049 win 3956 <nop,nop,timestamp 305527 305531,nop,nop,sack 1 {1441:1449}>
19:35:00.016350 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1049:1441(392) ack 1 win 2920 <nop,nop,timestamp 305531 305527>
19:35:00.016410 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1449 win 4480 <nop,nop,timestamp 305527 305531>
19:35:00.063240 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 305536 305527>
19:35:00.063313 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 1973 win 5004 <nop,nop,timestamp 305532 305536>
19:35:00.113219 IP 10.10.0.2.46650 > 10.50.0.2.9: . 1973:2497(524) ack 1 win 2920 <nop,nop,timestamp 305541 305532>
19:35:00.113293 IP 10.50.0.2.9 > 10.10.0.2.46650: . ack 2497 win 5528 <nop,nop,timestamp 305537 305541>
19:35:00.174065 IP 10.10.0.2.46650 > 10.50.0.2.9: FP 2497:3001(504) ack 1 win 2920 <nop,nop,timestamp 305547 305537>
19:35:00.178240 IP 10.50.0.2.9 > 10.10.0.2.46650: F 1:1(0) ack 3002 win 6052 <nop,nop,timestamp 305543 305547>
19:35:00.179498 IP 10.10.0.2.46650 > 10.50.0.2.9: . ack 2 win 2920 <nop,nop,timestamp 305547 305543>
\end{lstlisting}

\end{document}
